<header class="site-header" role="banner">
  <div class="header-content">
    <a aria-label="Home" class="home-link" href="/Academic-Allies/" title="Go Home">
    <img alt="Home" class="home-icon" src="/Academic-Allies/modular/icons/home.png" width="48" height="48" title="Academic Allies Home"/>
    </a>
      <span class="tagline" title="Academic Allies
Your disability accommodations and support network">Your disability accommodations and support network</span>
    <nav aria-label="Main navigation">
      <ul class="nav-list">
        <li><a href="/Academic-Allies/modular/components/calendar/calendar.html" title="Calendar">Calendar</a></li>
        <li><a href="/Academic-Allies/modular/emergency.html" title="Emergency Contact">Emergency Contact</a></li>
        <li><a href="/Academic-Allies/modular/checkin.html" title="Daily Check-In">Daily Check-In</a></li>
        <li><a href="/Academic-Allies/modular/icon-gallery.html" title="Icon Gallery">Icon Gallery</a></li>
        <li><a href="/Academic-Allies/modular/static/sitemap.html" title="Site Map">Site Map</a></li>
      </ul>
    </nav>
    <div style="display:flex;gap:10px;align-items:center;margin-left:20px;flex-wrap:wrap;">
      <span style="font-weight:600;color:#555;">Mode:</span>
      <a href="/Academic-Allies/" style="padding:8px 12px;background:#6CA0A3;color:#fff;text-decoration:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;"><img src="/Academic-Allies/modular/icons/mode-normal-outline.png" width="20" height="20" alt="Normal">Normal</a>
      <a href="/Academic-Allies/modular/components/recovery-mode.html" style="padding:8px 12px;background:#6CA0A3;color:#fff;text-decoration:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;"><img src="/Academic-Allies/modular/icons/mode-recovery.png" width="20" height="20" alt="Recovery">Recovery</a>
      <button onclick="alert('Bad Brain Day mode coming soon!')" style="padding:8px 12px;background:#999;color:#fff;border:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><img src="/Academic-Allies/modular/icons/mode-bad-brain-perplexity.png" width="20" height="20" alt="Bad Brain">Bad Brain</button>
      <button onclick="alert('Semi-Nope mode coming soon!')" style="padding:8px 12px;background:#999;color:#fff;border:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><img src="/Academic-Allies/modular/icons/mode-semi-nope-shadow.png" width="20" height="20" alt="Semi-Nope">Semi-Nope</button>
      <button onclick="alert('Nope mode coming soon!')" style="padding:8px 12px;background:#999;color:#fff;border:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><img src="/Academic-Allies/modular/icons/mode-nope-button.png" width="20" height="20" alt="Nope">Nope</button>
    </div>

    <div style="display:inline-flex;gap:10px;margin-left:auto">
      <a href="/Academic-Allies/modular/components/recovery-mode.html" style="padding:8px 12px;background:#6CA0A3;color:#fff;text-decoration:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px"><img src="/Academic-Allies/modular/icons/mode-recovery.png" width="20" height="20">Recovery</a>
      <a href="/Academic-Allies/modular/components/spoon-planner/spoon-planner.html" style="padding:8px 12px;background:#6CA0A3;color:#fff;text-decoration:none;border-radius:6px">ðŸ¥„ Spoons</a>
    </div>
    <div class="header-controls">
      <!-- User Info Display (hidden until signed in) -->
      <div id="userInfoDisplay" style="display: none; margin-right: 10px;">
        <span id="userNameDisplay"></span>
      </div>

      <!-- Google Sign-In Container -->
      <div id="googleSignInContainer"></div>

      <!-- Sign Out Button (hidden until signed in) -->
      <button id="signOutButton" style="display: none;">Sign Out</button>

      <!-- JS-Draggable Status Circle -->
      <div aria-label="Status: Not signed in" id="status-circle" tabindex="0" title="Click to toggle status, drag to reorder"></div>
    </div>
  </div>

  <!-- Status Circle Container -->
  <div aria-live="polite" id="status-circle-container" role="status" title="Authentication Status"></div>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer onload="initGoogleSignIn()"></script>

  <!-- Google Sign-In JavaScript -->
  <script>
    // This function will be called when Google Identity Services loads
    function initGoogleSignIn() {
      // Check if user is already signed in
      const savedUser = sessionStorage.getItem('academicAlliesUser');
      if (savedUser) {
        const userData = JSON.parse(savedUser);
        updateUIForSignedInUser(userData);
      }

      // Initialize Google Sign-In
      google.accounts.id.initialize({
        client_id: '93996985456-ffj2euk9i4q41v88njuhpusk73mdb31j.apps.googleusercontent.com',
        callback: handleCredentialResponse
      });

      google.accounts.id.renderButton(
        document.getElementById('googleSignInContainer'),
        {
          theme: 'outline',
          size: 'medium',
          type: 'standard',
          shape: 'rectangular',
          logo_alignment: 'left',
          text: 'signin_with'
        }
      );

      // Set up sign out button
      const signOutBtn = document.getElementById('signOutButton');
      if (signOutBtn) {
        signOutBtn.addEventListener('click', signOut);
      }
    }

    function handleCredentialResponse(response) {
      console.log('User signed in successfully');
      
      // Decode the JWT token to get user info
      const base64Url = response.credential.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      
      const userData = JSON.parse(jsonPayload);
      console.log('User data:', userData);

      // Store user info in session
      sessionStorage.setItem('academicAlliesUser', JSON.stringify({
        name: userData.name,
        email: userData.email,
        picture: userData.picture,
        sub: userData.sub
      }));

      // Update UI
      updateUIForSignedInUser({
        name: userData.name,
        email: userData.email,
        picture: userData.picture
      });
    }

    function updateUIForSignedInUser(userData) {
      // Hide sign-in button
      const signInContainer = document.getElementById('googleSignInContainer');
      if (signInContainer) signInContainer.style.display = 'none';
      
      // Show user info and sign out button
      const userInfoDisplay = document.getElementById('userInfoDisplay');
      const userNameDisplay = document.getElementById('userNameDisplay');
      const signOutButton = document.getElementById('signOutButton');
      
      if (userInfoDisplay) userInfoDisplay.style.display = 'block';
      if (userNameDisplay) userNameDisplay.textContent = 'Welcome, ' + userData.name;
      if (signOutButton) signOutButton.style.display = 'inline-block';
      
      // Update status circle
      const statusCircle = document.getElementById('status-circle');
      if (statusCircle) {
        statusCircle.classList.add('signed-in');
        statusCircle.setAttribute('aria-label', 'Status: Signed in as ' + userData.name);
        statusCircle.title = 'Signed in as ' + userData.name;
      }
    }

    function signOut() {
      // Clear session storage
      sessionStorage.removeItem('academicAlliesUser');
      
      // Reset UI
      const signInContainer = document.getElementById('googleSignInContainer');
      const userInfoDisplay = document.getElementById('userInfoDisplay');
      const signOutButton = document.getElementById('signOutButton');
      
      if (signInContainer) signInContainer.style.display = 'block';
      if (userInfoDisplay) userInfoDisplay.style.display = 'none';
      if (signOutButton) signOutButton.style.display = 'none';
      
      // Reset status circle
      const statusCircle = document.getElementById('status-circle');
      if (statusCircle) {
        statusCircle.classList.remove('signed-in');
        statusCircle.setAttribute('aria-label', 'Status: Not signed in');
        statusCircle.title = 'Click to toggle status, drag to reorder';
      }
      
      console.log('User signed out');
    }

    // If Google library is already loaded (for dynamically inserted headers), initialize now
    if (typeof google !== 'undefined' && google.accounts) {
      initGoogleSignIn();
    }
  </script>
<script src="/Academic-Allies/modular/js/draggable.js"></script>
</header>

<style>
.site-header {
  background: #f8f9fa;
  border-bottom: 1px solid #e1e5e9;
  padding: 12px 20px;
}

.header-content {
  justify-content: flex-start;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
}

.home-link {
  display: flex;
  align-items: center;
  text-decoration: none;
  color: #333;
  font-weight: 600;
}

.home-link:hover {
  color: #0066cc;
}

.home-icon {
  margin-right: 8px;
}

.nav-list {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 20px;
}

.nav-list li {
  margin: 0;
}

.nav-list a {
  text-decoration: none;
  color: #555;
  font-weight: 500;
  padding: 8px 12px;
  border-radius: 4px;
  transition: background-color 0.2s;
}

.nav-list a:hover {
  background-color: #e9ecef;
  color: #333;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 15px;
}

#userInfoDisplay {
  font-weight: 500;
  color: #333;
}

#signOutButton {
  padding: 8px 16px;
  background-color: #dc3545;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 500;
}

#signOutButton:hover {
  background-color: #c82333;
}

#status-circle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #dc3545;
  cursor: pointer;
  position: fixed; top: 16px; right: 16px; z-index: 1000;
  transition: background-color 0.3s;
}

#status-circle:hover {
  background-color: #c82333;
}

#status-circle.signed-in {
  background-color: #28a745;
}

#status-circle.signed-in:hover {
  background-color: #218838;
}

@media (max-width: 768px) {
  .header-content {
  justify-content: flex-start;
    gap: 15px;
  }

  .nav-list {
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 10px;
  }
}</style>
