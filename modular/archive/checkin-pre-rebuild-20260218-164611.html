<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Academic Allies – Daily Check-In</title>
  <link rel="icon" href="/favicon.ico">
  <link href="./css/style.css" rel="stylesheet" />
</head>
<body>
  <!-- Header injected here -->
  <div id="site-header"></div>

  <main id="checkin-page">
    <h2>Daily Check-In</h2>
    <div id="checkin-component-container">
      <!-- Loading state -->
      <p style="text-align: center; color: #666; margin-top: 2rem;">Loading check-in…</p>
    </div>
  </main>

  <!-- Firebase SDK -->
  <script type="module">
    // Replace with YOUR real Firebase config from Firebase Console
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    window.firebaseAuth = auth; // expose for spoon-planner.js

    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("[auth] Signed in as:", user.email);
        // If you want to hide/show UI based on registration, do it here
      } else {
        console.log("[auth] No user signed in");
        document.getElementById('checkin-component-container').innerHTML = `
          <div style="text-align: center; padding: 2rem;">
            <h3>Please sign in</h3>
            <p>You need to be logged in to access the daily check-in.</p>
          </div>
        `;
      }
    });
  </script>

  <!-- Check-in render (will fail gracefully if spoon-planner.js missing) -->
  <script type="module">
    try {
      const { renderCheckIn } = await import('./components/spoon-planner/js/spoon-planner.js');
      renderCheckIn(document.getElementById('checkin-component-container'), window.firebaseAuth);
    } catch (err) {
      console.error("Failed to load spoon-planner:", err);
      document.getElementById('checkin-component-container').innerHTML = `
        <div style="text-align: center; padding: 2rem; color: #d32f2f;">
          <h3>Check-in failed to load</h3>
          <p>Something went wrong loading the check-in tool. Please refresh or contact support.</p>
        </div>
      `;
    }
  </script>

  <!-- Header loader -->
  <script>
    fetch('/Academic-Allies/modular/shared-header.html')
      .then(response => {
        if (!response.ok) throw new Error('Header not found');
        return response.text();
      })
      .then(html => {
        const container = document.getElementById('site-header');
        container.innerHTML = html;

        const scripts = container.querySelectorAll('script');
        scripts.forEach(oldScript => {
          const newScript = document.createElement('script');
          Array.from(oldScript.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value));
          newScript.textContent = oldScript.textContent;
          oldScript.replaceWith(newScript);
        });

        const dragScript = document.createElement('script');
        dragScript.src = '/Academic-Allies/modular/js/draggable.js';
        dragScript.onload = () => { if (typeof initDrag === 'function') initDrag(); };
        document.body.appendChild(dragScript);
      })
      .catch(err => console.error('Header load error:', err));
  </script>
</body>
</html>
