<!DOCTYPE html>
<!-- ============================================================
     support-dashboard/support-dashboard.html
     Created: 2026-02-19 by Claude
     Read-only view of a student's wellness data for support
     network members (family, nearby-help, support, admin).
     Sections: Status, Check-ins, Flower Quiz, Today's Meals, Message.
     Each section is individually toggleable; prefs saved per viewer.
     Real-time Firestore listeners for status + today's log.
     ============================================================ -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support Dashboard â€” Academic Allies</title>
  <link rel="icon" href="/Academic-Allies/favicon.ico">
  <style>
    body { font-family: 'Atkinson Hyperlegible', Arial, sans-serif; background: #FAFAF9; color: #333; margin: 0; padding: 16px; }
    .page-wrap { max-width: 820px; margin: 0 auto; padding-top: 12px; }

    /* Header */
    .dash-header { display: flex; align-items: center; gap: 14px; margin-bottom: 6px; flex-wrap: wrap; }
    .dash-header h1 { margin: 0; font-size: 1.5rem; color: #4a7f82; }
    .dash-header .sub { color: #888; font-size: 0.88rem; margin: 0 0 20px; }
    .student-badge {
      display: inline-flex; align-items: center; gap: 7px;
      background: #e8f5ee; border: 1px solid #b2d4c8; border-radius: 20px;
      padding: 5px 14px; font-size: 0.85rem; font-weight: 600; color: #2e6b4f;
    }
    .student-badge img { width: 22px; height: 22px; border-radius: 50%; }

    /* Student picker (if in multiple networks) */
    #student-picker-wrap { margin-bottom: 18px; }
    #student-picker-wrap label { font-size: 0.85rem; color: #888; margin-right: 8px; }
    #student-picker { padding: 7px 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }

    /* Toggle bar */
    .toggle-bar {
      display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px;
      padding: 12px 16px; background: #f0f8f8; border-radius: 10px; border: 1px solid #c9e4d8;
    }
    .toggle-bar label { font-size: 0.82rem; color: #555; display: flex; align-items: center; gap: 5px; cursor: pointer; }
    .toggle-bar input[type=checkbox] { accent-color: #4a7f82; width: 15px; height: 15px; cursor: pointer; }

    /* Sections */
    .dash-section {
      background: #fff; border: 1px solid #e1e5e9; border-radius: 12px;
      margin-bottom: 16px; overflow: hidden; box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .section-header {
      padding: 13px 18px; font-weight: 700; font-size: 0.95rem;
      border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 8px;
    }
    .section-body { padding: 16px 18px; }

    /* Status section */
    .status-dot {
      width: 18px; height: 18px; border-radius: 50%; display: inline-block;
      flex-shrink: 0; vertical-align: middle;
    }
    .status-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .status-label { font-size: 1rem; font-weight: 600; }
    .status-since { font-size: 0.8rem; color: #aaa; }
    .nope-details { background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; padding: 10px 14px; margin-top: 8px; font-size: 0.88rem; color: #7f1d1d; }

    /* Check-in log */
    .checkin-row {
      display: flex; align-items: flex-start; gap: 10px;
      padding: 9px 0; border-bottom: 1px solid #f5f5f5; font-size: 0.88rem;
    }
    .checkin-row:last-child { border-bottom: none; }
    .checkin-dot { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }
    .checkin-date { font-weight: 600; color: #444; min-width: 90px; }
    .checkin-mood { color: #666; }
    .checkin-badges { display: flex; gap: 5px; flex-wrap: wrap; margin-top: 4px; }
    .badge-sm {
      font-size: 0.7rem; padding: 2px 7px; border-radius: 10px;
      background: #e8f5ee; color: #2e6b4f; border: 1px solid #c9e4d8;
    }
    .badge-sm.bad { background: #fef2f2; color: #b91c1c; border-color: #fca5a5; }
    .checkin-notes { color: #777; font-style: italic; margin-top: 3px; font-size: 0.82rem; }

    /* Flower quiz */
    .quiz-progress-wrap { margin: 10px 0 4px; }
    .quiz-bar-bg { background: #e8f5ee; border-radius: 20px; height: 14px; overflow: hidden; }
    .quiz-bar-fill { background: #4a7f82; height: 100%; border-radius: 20px; transition: width 0.5s; }
    .quiz-count { font-size: 1.3rem; font-weight: 700; color: #4a7f82; margin-top: 6px; }
    .quiz-sub { font-size: 0.82rem; color: #aaa; }

    /* Meals */
    .meal-row { display: flex; align-items: baseline; gap: 8px; padding: 7px 0; border-bottom: 1px solid #f5f5f5; font-size: 0.88rem; }
    .meal-row:last-child { border-bottom: none; }
    .meal-type-tag { font-size: 0.72rem; background: #e8f5ee; color: #2e6b4f; border-radius: 4px; padding: 1px 7px; font-weight: 600; flex-shrink: 0; }
    .meal-name { color: #333; }
    .meal-time { font-size: 0.78rem; color: #aaa; margin-left: auto; flex-shrink: 0; }

    /* Message button */
    .msg-btn {
      display: inline-flex; align-items: center; gap: 8px;
      background: #4a7f82; color: #fff; text-decoration: none;
      padding: 10px 22px; border-radius: 8px; font-size: 0.95rem; font-weight: 600;
      transition: background 0.15s;
    }
    .msg-btn:hover { background: #3d6e71; }

    /* Mirror banner */
    .mirror-notice {
      background: linear-gradient(135deg, #e8eeff, #f0f4ff);
      border: 2px solid #a5b4fc; border-radius: 10px;
      padding: 12px 18px; margin-bottom: 18px; font-size: 0.88rem; color: #4338ca;
      display: flex; align-items: center; gap: 10px;
    }

    /* Loading / states */
    #loading-msg, #signin-msg { text-align: center; padding: 50px; color: #aaa; font-size: 1rem; }
    .empty-msg { color: #bbb; font-size: 0.88rem; text-align: center; padding: 14px 0; }
  </style>
</head>
<body>
  <div id="site-header"></div>

  <div class="page-wrap">
    <div id="loading-msg">Loading dashboardâ€¦</div>
    <div id="signin-msg" style="display:none;">Please sign in to access the support dashboard.</div>

    <div id="dash-body" style="display:none;">

      <!-- Mirror notice -->
      <div class="mirror-notice">
        ğŸª <span>You're in <strong>read-only mirror mode</strong> â€” you can view but not change anything here.</span>
      </div>

      <!-- Student picker (shown when in multiple networks) -->
      <div id="student-picker-wrap" style="display:none;">
        <label for="student-picker">Viewing:</label>
        <select id="student-picker" onchange="switchStudent(this.value)"></select>
      </div>

      <!-- Header with student name -->
      <div class="dash-header">
        <h1 id="dash-title">ğŸ“Š Support Dashboard</h1>
        <div class="student-badge" id="student-badge" style="display:none;">
          <img id="student-icon" src="/Academic-Allies/modular/icons/icon-user-student.png" alt="">
          <span id="student-name-badge">Loadingâ€¦</span>
        </div>
      </div>
      <p class="sub">Real-time read-only view of <span id="student-name-sub">your student</span>'s wellness data.</p>

      <!-- Section toggles -->
      <div class="toggle-bar" id="toggle-bar">
        <strong style="font-size:0.82rem;color:#4a7f82;margin-right:4px;">Show:</strong>
        <label><input type="checkbox" id="tog-status"  onchange="savePrefs()" checked> ğŸ”´ Status</label>
        <label><input type="checkbox" id="tog-checkins" onchange="savePrefs()" checked> ğŸ“ Check-ins</label>
        <label><input type="checkbox" id="tog-quiz"    onchange="savePrefs()" checked> ğŸŒ¸ Flower Quiz</label>
        <label><input type="checkbox" id="tog-meals"   onchange="savePrefs()" checked> ğŸ½ Today's Meals</label>
        <label><input type="checkbox" id="tog-message" onchange="savePrefs()" checked> ğŸ’¬ Message</label>
      </div>

      <!-- â‘  Status / Nope mode -->
      <div class="dash-section" id="sec-status">
        <div class="section-header">ğŸ”´ Current Status</div>
        <div class="section-body" id="status-body">
          <div class="status-row">
            <span class="status-dot" id="status-dot" style="background:#9E9E9E;"></span>
            <span class="status-label" id="status-label">Loadingâ€¦</span>
          </div>
          <div class="status-since" id="status-since"></div>
          <div id="nope-details" style="display:none;"></div>
        </div>
      </div>

      <!-- â‘¡ Check-in log -->
      <div class="dash-section" id="sec-checkins">
        <div class="section-header">ğŸ“ Recent Check-ins <span style="font-size:0.75rem;font-weight:400;color:#aaa;margin-left:6px;">last 7 days</span></div>
        <div class="section-body" id="checkins-body">
          <div class="empty-msg">Loading check-insâ€¦</div>
        </div>
      </div>

      <!-- â‘¢ Flower quiz -->
      <div class="dash-section" id="sec-quiz">
        <div class="section-header">ğŸŒ¸ Flower Quiz Progress</div>
        <div class="section-body" id="quiz-body">
          <div class="empty-msg">Loadingâ€¦</div>
        </div>
      </div>

      <!-- â‘£ Today's meals -->
      <div class="dash-section" id="sec-meals">
        <div class="section-header">ğŸ½ Today's Meals <span style="font-size:0.75rem;font-weight:400;color:#aaa;margin-left:6px;" id="meals-date"></span></div>
        <div class="section-body" id="meals-body">
          <div class="empty-msg">Loading mealsâ€¦</div>
        </div>
      </div>

      <!-- â‘¤ Message -->
      <div class="dash-section" id="sec-message">
        <div class="section-header">ğŸ’¬ Message</div>
        <div class="section-body">
          <a id="msg-link" href="/Academic-Allies/modular/components/message-system/message-system.html" class="msg-btn">
            ğŸ’¬ Open Messages
          </a>
          <p style="font-size:0.82rem;color:#aaa;margin:10px 0 0;">Opens your full message thread with <span id="msg-student-name">this student</span>.</p>
        </div>
      </div>

    </div><!-- /dash-body -->
  </div>

  <!-- Shared header loader -->
  <script>
    fetch('/Academic-Allies/modular/shared-header.html?v=20260220d')
      .then(function(r) { return r.text(); })
      .then(function(html) {
        var c = document.getElementById('site-header');
        c.innerHTML = html;
        c.querySelectorAll('script').forEach(function(old) {
          var s = document.createElement('script');
          Array.from(old.attributes).forEach(function(a) { s.setAttribute(a.name, a.value); });
          s.textContent = old.textContent;
          old.replaceWith(s);
        });
      });
  </script>

  <script>
    /* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    var viewerUid      = null;
    var viewerName     = null;
    var studentUid     = null;
    var studentName    = null;
    var studentsInNetwork = [];  // [{uid, name, tier}] â€” all students this viewer is in

    var unsubNope      = null;
    var unsubMeals     = null;

    var dateKey = new Date().toISOString().split('T')[0];

    /* â”€â”€ Wait for AA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function waitForAA(cb, tries) {
      tries = tries || 0;
      if (window.AA && window.AA.auth && window.AA.db) { cb(); return; }
      if (tries > 40) { document.getElementById('loading-msg').textContent = 'Could not connect â€” please refresh.'; return; }
      setTimeout(function() { waitForAA(cb, tries + 1); }, 200);
    }

    /* â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function boot() {
      AA.auth.onAuthStateChanged(function(user) {
        if (!user) {
          document.getElementById('loading-msg').style.display = 'none';
          document.getElementById('signin-msg').style.display  = 'block';
          return;
        }
        viewerUid  = user.uid;
        viewerName = user.displayName || user.email;

        loadPrefs();
        findStudents();
      });
    }

    /* â”€â”€ Find which student(s) this viewer is in â”€â”€â”€â”€â”€â”€â”€â”€ */
    function findStudents() {
      /* Scan all users for supportNetwork entries containing this viewer */
      AA.db.collection('users').get().then(function(snap) {
        studentsInNetwork = [];
        snap.forEach(function(doc) {
          var d = doc.data();
          if (d.role === 'student' && d.supportNetwork && d.supportNetwork[viewerUid]) {
            studentsInNetwork.push({
              uid:  doc.id,
              name: d.displayName || d.email,
              tier: d.supportNetwork[viewerUid]
            });
          }
        });

        if (studentsInNetwork.length === 0) {
          document.getElementById('loading-msg').textContent =
            'You\'re not in any student\'s support network yet. Ask your student to add you via User Roles & Tiers.';
          return;
        }

        /* Self-heal: if viewer is a student who got here, make sure isSupporter flag is set
           so the Support Dashboard card shows on their home page going forward */
        AA.getUserDoc(viewerUid).then(function(vDoc) {
          if (vDoc.exists && vDoc.data().role === 'student' && !vDoc.data().isSupporter) {
            AA.db.collection('users').doc(viewerUid).update({ isSupporter: true }).catch(function(){});
          }
        }).catch(function(){});

        if (studentsInNetwork.length > 1) {
          buildStudentPicker();
        }

        showDashboard(studentsInNetwork[0].uid, studentsInNetwork[0].name);
      }).catch(function(err) {
        document.getElementById('loading-msg').textContent = 'Error: ' + err.message;
      });
    }

    /* â”€â”€ Build student picker dropdown (multiple students) */
    function buildStudentPicker() {
      var sel = document.getElementById('student-picker');
      sel.innerHTML = '';
      studentsInNetwork.forEach(function(s) {
        var opt = document.createElement('option');
        opt.value       = s.uid;
        opt.textContent = s.name;
        sel.appendChild(opt);
      });
      document.getElementById('student-picker-wrap').style.display = 'block';
    }

    function switchStudent(uid) {
      var s = studentsInNetwork.find(function(x) { return x.uid === uid; });
      if (s) showDashboard(s.uid, s.name);
    }

    /* â”€â”€ Show dashboard for a specific student â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function showDashboard(uid, name) {
      studentUid  = uid;
      studentName = name;

      document.getElementById('loading-msg').style.display  = 'none';
      document.getElementById('dash-body').style.display    = 'block';
      document.getElementById('student-badge').style.display = 'flex';
      document.getElementById('student-name-badge').textContent = name;
      document.getElementById('student-name-sub').textContent   = name + "'s";
      document.getElementById('msg-student-name').textContent   = name;
      document.getElementById('meals-date').textContent = dateKey;

      applyToggles();
      startNopeListener();
      loadCheckins();
      loadQuizProgress();
      startMealListener();
    }

    /* â”€â”€ â‘  Nope / Status real-time listener â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    var STATUS_COLORS = {
      'nope':     '#dc3545',
      'semi':     '#fd7e14',
      'recovery': '#20c997',
      null:       '#9E9E9E'
    };
    var STATUS_LABELS = {
      'nope':     'ğŸ”´ Nope Mode active',
      'semi':     'ğŸŸ  Semi-Nope (limited)',
      'recovery': 'ğŸŒ¿ Recovery Mode',
      null:       'ğŸŸ¢ No active alerts'
    };

    function startNopeListener() {
      if (unsubNope) { unsubNope(); }
      unsubNope = AA.watchNope(studentUid, function(data) {
        var mode  = data ? data.mode : null;
        var color = STATUS_COLORS[mode] || STATUS_COLORS[null];
        var label = STATUS_LABELS[mode] || STATUS_LABELS[null];

        document.getElementById('status-dot').style.background = color;
        document.getElementById('status-label').textContent     = label;

        var sinceEl   = document.getElementById('status-since');
        var detailsEl = document.getElementById('nope-details');

        if (data && data.activatedAt) {
          var d = data.activatedAt.toDate ? data.activatedAt.toDate() : new Date(data.activatedAt);
          sinceEl.textContent = 'Since ' + d.toLocaleString([], { dateStyle: 'short', timeStyle: 'short' });
        } else {
          sinceEl.textContent = '';
        }

        if (mode === 'nope' || mode === 'semi') {
          detailsEl.style.display = 'block';
          detailsEl.innerHTML = '<strong>' + (mode === 'nope' ? 'Full Nope' : 'Semi-Nope') + '</strong> â€” ' +
            studentName + ' has limited capacity right now. Please check in gently.';
          detailsEl.className = 'nope-details';
        } else {
          detailsEl.style.display = 'none';
        }
      });
    }

    /* â”€â”€ â‘¡ Check-in log (last 7 days) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function loadCheckins() {
      var body = document.getElementById('checkins-body');
      body.innerHTML = '<div class="empty-msg">Loadingâ€¦</div>';

      AA.getRecentCheckins(studentUid, 7).then(function(days) {
        if (!days || days.length === 0) {
          body.innerHTML = '<div class="empty-msg">No check-ins in the last 7 days.</div>';
          return;
        }

        body.innerHTML = days.map(function(day) {
          /* Use the last entry of that day */
          var entry = Array.isArray(day.entries) && day.entries.length > 0
            ? day.entries[day.entries.length - 1] : null;
          if (!entry) return '';

          var dot   = day.latestFlag === 'red' ? 'ğŸ”´' : day.latestFlag === 'yellow' ? 'ğŸŸ¡' : 'ğŸŸ¢';
          var badges = [];
          if (entry.ate   === true)  badges.push('<span class="badge-sm">ate âœ“</span>');
          if (entry.ate   === false) badges.push('<span class="badge-sm bad">missed meal</span>');
          if (entry.water === false) badges.push('<span class="badge-sm bad">low water</span>');
          if (entry.meds  === false) badges.push('<span class="badge-sm bad">missed meds</span>');
          if (entry.symptoms === 'yes' && entry.symptomList && entry.symptomList.length)
            badges.push('<span class="badge-sm bad">' + esc(entry.symptomList.slice(0,2).join(', ')) + '</span>');

          return '<div class="checkin-row">' +
            '<span class="checkin-dot">' + dot + '</span>' +
            '<div style="flex:1;min-width:0;">' +
              '<span class="checkin-date">' + esc(day.date) + '</span>' +
              (entry.mood ? ' <span class="checkin-mood">â€” ' + esc(entry.mood) + '</span>' : '') +
              (badges.length ? '<div class="checkin-badges">' + badges.join('') + '</div>' : '') +
              (entry.notes ? '<div class="checkin-notes">' + esc(entry.notes) + '</div>' : '') +
            '</div>' +
          '</div>';
        }).join('');
      }).catch(function(err) {
        body.innerHTML = '<div class="empty-msg" style="color:#c0392b;">Could not load check-ins: ' + esc(err.message) + '</div>';
      });
    }

    /* â”€â”€ â‘¢ Flower quiz progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function loadQuizProgress() {
      var body = document.getElementById('quiz-body');
      AA.getFlowerQuiz(studentUid).then(function(doc) {
        var count = doc.exists ? (doc.data().flowerCount || 0) : 0;
        /* Updated 2026-03-01 by Claude: changed total from 40â†’31 to match TOTAL_FLOWERS in admin.html */
        var pct   = Math.min(Math.round(count / 31 * 100), 100);
        body.innerHTML =
          '<div class="quiz-count">' + count + ' <span style="font-size:0.9rem;font-weight:400;color:#aaa;">/ 31 flowers</span></div>' +
          '<div class="quiz-progress-wrap">' +
            '<div class="quiz-bar-bg"><div class="quiz-bar-fill" style="width:' + pct + '%;"></div></div>' +
          '</div>' +
          '<div class="quiz-sub">' + pct + '% through the full set</div>';
      }).catch(function(err) {
        body.innerHTML = '<div class="empty-msg" style="color:#c0392b;">Could not load quiz data: ' + esc(err.message) + '</div>';
      });
    }

    /* â”€â”€ â‘£ Today's meals real-time listener â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function startMealListener() {
      if (unsubMeals) { unsubMeals(); }
      unsubMeals = AA.watchMealLog(studentUid, dateKey, function(data) {
        var body   = document.getElementById('meals-body');
        var meals  = data && Array.isArray(data.meals) ? data.meals : [];
        if (meals.length === 0) {
          body.innerHTML = '<div class="empty-msg">Nothing logged yet today.</div>';
          return;
        }
        body.innerHTML = meals.map(function(m) {
          var timeStr = m.time ? to12H(m.time) : '';
          return '<div class="meal-row">' +
            (m.type ? '<span class="meal-type-tag">' + esc(m.type) + '</span>' : '') +
            '<span class="meal-name">' + esc(m.name || '(unnamed)') + '</span>' +
            (timeStr ? '<span class="meal-time">ğŸ• ' + timeStr + '</span>' : '') +
          '</div>';
        }).join('');
      });
    }

    /* â”€â”€ Section toggles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    var SECTION_MAP = {
      'tog-status':   'sec-status',
      'tog-checkins': 'sec-checkins',
      'tog-quiz':     'sec-quiz',
      'tog-meals':    'sec-meals',
      'tog-message':  'sec-message'
    };

    function applyToggles() {
      Object.keys(SECTION_MAP).forEach(function(togId) {
        var cb  = document.getElementById(togId);
        var sec = document.getElementById(SECTION_MAP[togId]);
        if (cb && sec) sec.style.display = cb.checked ? 'block' : 'none';
      });
    }

    function savePrefs() {
      applyToggles();
      if (!viewerUid) return;
      var prefs = {};
      Object.keys(SECTION_MAP).forEach(function(togId) {
        var cb = document.getElementById(togId);
        if (cb) prefs[togId] = cb.checked;
      });
      try { localStorage.setItem('supportDashPrefs_' + viewerUid, JSON.stringify(prefs)); } catch(e) {}
    }

    function loadPrefs() {
      if (!viewerUid) return;
      try {
        var raw = localStorage.getItem('supportDashPrefs_' + viewerUid);
        if (!raw) return;
        var prefs = JSON.parse(raw);
        Object.keys(SECTION_MAP).forEach(function(togId) {
          var cb = document.getElementById(togId);
          if (cb && typeof prefs[togId] === 'boolean') cb.checked = prefs[togId];
        });
      } catch(e) {}
    }

    /* â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    function to12H(t) {
      if (!t) return '';
      var parts = t.split(':');
      var h = parseInt(parts[0], 10), m = parts[1];
      var ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12 || 12;
      return h + ':' + m + ' ' + ampm;
    }

    function esc(s) {
      return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    }

    waitForAA(boot);
  </script>
</body>
</html>
