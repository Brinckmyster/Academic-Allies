<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SpoonPal Template Manager</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  margin: 1em; 
  background: #f9f9f9; 
  max-width: 1200px; 
  margin: 0 auto; 
  padding: 1em;
}
h1, h2 { color: #333; }
.section {
  background: white; 
  padding: 1em; 
  margin-bottom: 1em; 
  border-radius: 8px; 
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
label { 
  display: block; 
  margin-top: 0.5em; 
  font-weight: bold;
}
input, select, textarea {
  width: 100%; 
  padding: 0.5em; 
  margin: 0.2em 0; 
  border: 1px solid #ddd; 
  border-radius: 4px;
  font-size: 14px;
}
button {
  background: #2a7ae2; 
  color: white; 
  padding: 0.7em 1.4em; 
  border: none; 
  border-radius: 4px;
  margin: 0.5em 0.5em 0.5em 0; 
  cursor: pointer;
  font-size: 14px;
}
button:hover { background: #1e5bb8; }
button:disabled { background: #999; cursor: not-allowed; }
.lmj-order { 
  background: #e8f4fd; 
  padding: 1em; 
  border-left: 4px solid #2a7ae2; 
  margin: 1em 0;
}
.task-row {
  display: grid;
  grid-template-columns: 80px 60px 2fr 100px 80px 100px 1fr;
  gap: 0.5em;
  align-items: center;
  padding: 0.5em;
  border-bottom: 1px solid #eee;
}
.task-row:hover { background: #f5f5f5; }
.task-header {
  font-weight: bold;
  background: #f0f0f0;
  border-bottom: 2px solid #ddd;
}
.template-preview {
  background: #f8f8f8;
  padding: 1em;
  border-radius: 4px;
  font-family: monospace;
  white-space: pre-wrap;
  max-height: 400px;
  overflow-y: auto;
}
.warning {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  color: #856404;
  padding: 1em;
  border-radius: 4px;
  margin: 1em 0;
}
.success {
  background: #d4edda;
  border: 1px solid #c3e6cb;
  color: #155724;
  padding: 1em;
  border-radius: 4px;
  margin: 1em 0;
}
</style>
</head>
<body>

<h1>ğŸ¥„ SpoonPal Template Manager</h1>

<div class="section">
  <h2>Protocol Configuration</h2>
  <div class="lmj-order">
    <strong>LMJ Order (Protocol-Locked):</strong> AğŸ’Š, VğŸ¦¾, BğŸ½ï¸, GğŸ¥, NğŸ“°, MEğŸ§˜, HğŸ§º, CCğŸ›ï¸, DDğŸ’¨, EEğŸ˜·, FFğŸ¤š, ZZğŸ“µ
    <br><small>H always comes after ME. G is reserved for Gosling time. Flexible tasks slot between B and G unless specified.</small>
  </div>
  
  <label for="templateName">Template Name:</label>
  <input type="text" id="templateName" placeholder="e.g., Monday Template, Thursday Workday, Weekend Recovery">
  
  <label for="templateType">Template Type:</label>
  <select id="templateType">
    <option value="daily">Daily Template</option>
    <option value="workday">Workday Template</option>
    <option value="recovery">Recovery Day Template</option>
    <option value="weekend">Weekend Template</option>
  </select>
</div>

<div class="section">
  <h2>Task Editor</h2>
  <div id="taskEditor">
    <div class="task-row task-header">
      <div>Time</div>
      <div>LMJ</div>
      <div>Task Description</div>
      <div>Priority</div>
      <div>Spoons</div>
      <div>Type</div>
      <div>Area/Notes</div>
    </div>
  </div>
  <button id="addTaskBtn">+ Add Task</button>
  <button id="addLmjOrderBtn">+ Add LMJ Sequence</button>
</div>

<div class="section">
  <h2>Template Management</h2>
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1em;">
    <div>
      <button id="saveTemplateBtn">ğŸ’¾ Save Template</button>
      <button id="loadTemplateBtn">ğŸ“ Load Template</button>
      <button id="exportTemplateBtn">ğŸ“¤ Export for Academic Allies</button>
    </div>
    <div>
      <select id="templateSelect" style="margin-bottom: 0.5em;">
        <option value="">Select saved template...</option>
      </select>
      <button id="deleteTemplateBtn">ğŸ—‘ï¸ Delete Template</button>
    </div>
  </div>
</div>

<div class="section">
  <h2>Preview</h2>
  <div id="templatePreview" class="template-preview">Template preview will appear here...</div>
</div>

<script>
// LMJ Protocol Configuration
const LMJ_ORDER = ['A', 'V', 'B', 'G', 'N', 'ME', 'H', 'CC', 'DD', 'EE', 'FF', 'ZZ'];
const LMJ_EMOJIS = {
  'A': 'ğŸ’Š', 'V': 'ğŸ¦¾', 'B': 'ğŸ½ï¸', 'G': 'ğŸ¥', 'N': 'ğŸ“°', 'ME': 'ğŸ§˜', 
  'H': 'ğŸ§º', 'CC': 'ğŸ›ï¸', 'DD': 'ğŸ’¨', 'EE': 'ğŸ˜·', 'FF': 'ğŸ¤š', 'ZZ': 'ğŸ“µ'
};

let currentTasks = [];
let savedTemplates = JSON.parse(localStorage.getItem('spoonpalTemplates') || '{}');

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  refreshTemplateSelect();
  addSampleTasks();
  updatePreview();
  
  // Event listeners
  document.getElementById('addTaskBtn').addEventListener('click', addTask);
  document.getElementById('addLmjOrderBtn').addEventListener('click', addLmjSequence);
  document.getElementById('saveTemplateBtn').addEventListener('click', saveTemplate);
  document.getElementById('loadTemplateBtn').addEventListener('click', loadTemplate);
  document.getElementById('exportTemplateBtn').addEventListener('click', exportTemplate);
  document.getElementById('deleteTemplateBtn').addEventListener('click', deleteTemplate);
});

function addTask(time = '', lmj = '', description = '', priority = 'High', spoons = '1', type = 'Fixed', notes = '') {
  const taskId = 'task_' + Date.now() + Math.random();
  const taskRow = document.createElement('div');
  taskRow.className = 'task-row';
  taskRow.innerHTML = `
    <input type="text" value="${time}" placeholder="730 AM" onchange="updatePreview()">
    <select onchange="updatePreview()">
      <option value="">--</option>
      ${LMJ_ORDER.map(code => `<option value="${code}" ${lmj === code ? 'selected' : ''}>${code}${LMJ_EMOJIS[code]}</option>`).join('')}
    </select>
    <input type="text" value="${description}" placeholder="Task description" onchange="updatePreview()">
    <select onchange="updatePreview()">
      <option value="High" ${priority === 'High' ? 'selected' : ''}>High</option>
      <option value="Medium" ${priority === 'Medium' ? 'selected' : ''}>Medium</option>
      <option value="Low" ${priority === 'Low' ? 'selected' : ''}>Low</option>
    </select>
    <input type="number" value="${spoons}" min="0" max="10" step="0.5" onchange="updatePreview()">
    <select onchange="updatePreview()">
      <option value="Fixed" ${type === 'Fixed' ? 'selected' : ''}>Fixed</option>
      <option value="Flexible" ${type === 'Flexible' ? 'selected' : ''}>Flexible</option>
      <option value="Urgent" ${type === 'Urgent' ? 'selected' : ''}>Urgent</option>
    </select>
    <input type="text" value="${notes}" placeholder="Area/Notes" onchange="updatePreview()">
    <button onclick="removeTask(this)" style="background: #dc3545; padding: 0.3em;">Ã—</button>
  `;
  document.getElementById('taskEditor').appendChild(taskRow);
  updatePreview();
}

function addLmjSequence() {
  const commonTasks = {
    'A': ['Morning medications', 'High', '2', 'Fixed', 'Essential start'],
    'V': ['CPAP prep, wrist brace', 'High', '1', 'Fixed', 'After A'],
    'B': ['Family scriptures, breakfast', 'High', '2', 'Fixed', 'PB&fruit, hydrate'],
    'G': ['Gosling time', 'High', '1', 'Fixed', 'PM, fixed 2 wks'],
    'N': ['News with Mom', 'High', '1', 'Fixed', 'NBC/EWT/YouTube'],
    'ME': ['Me time', 'High', '0', 'Fixed', 'Recovery'],
    'H': ['Hamper, clothes, bathroom', 'High', '1', 'Fixed', 'After ME'],
    'CC': ['In bed', 'High', '0', 'Fixed', 'Settle in'],
    'DD': ['Breathe, recover', 'High', '0', 'Fixed', 'Post-movement'],
    'EE': ['CPAP mask on', 'High', '0.5', 'Fixed', 'Final prep'],
    'FF': ['Wrist brace on', 'High', '0.5', 'Fixed', 'If needed'],
    'ZZ': ['Device off, crash', 'High', '0', 'Fixed', 'Sleep initiation']
  };
  
  let time = 800; // Start at 8:00 AM
  LMJ_ORDER.forEach(lmj => {
    if (commonTasks[lmj]) {
      const [desc, priority, spoons, type, notes] = commonTasks[lmj];
      const timeStr = formatTime(time);
      addTask(timeStr, lmj, desc, priority, spoons, type, notes);
      time += 30; // 30 minutes between tasks
    }
  });
}

function formatTime(minutes) {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  const period = hours >= 12 ? 'PM' : 'AM';
  const displayHour = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
  return `${displayHour}${mins > 0 ? ':' + mins.toString().padStart(2, '0') : ''} ${period}`;
}

function addSampleTasks() {
  addTask('830 AM', 'A', 'Morning medications', 'High', '2', 'Fixed', 'Essential start');
  addTask('900 AM', 'B', 'Family scriptures, breakfast', 'High', '2', 'Fixed', 'PB&fruit, hydrate');
}

function removeTask(button) {
  button.parentElement.remove();
  updatePreview();
}

function updatePreview() {
  const tasks = [];
  const taskRows = document.querySelectorAll('.task-row:not(.task-header)');
  
  taskRows.forEach(row => {
    const inputs = row.querySelectorAll('input, select');
    if (inputs.length >= 7) {
      tasks.push({
        time: inputs[0].value,
        lmj: inputs[1].value,
        description: inputs[2].value,
        priority: inputs[3].value,
        spoons: inputs[4].value,
        type: inputs[5].value,
        notes: inputs[6].value
      });
    }
  });
  
  let preview = generateTemplatePreview(tasks);
  document.getElementById('templatePreview').textContent = preview;
}

function generateTemplatePreview(tasks) {
  const templateName = document.getElementById('templateName').value || 'Untitled Template';
  
  let output = `# ${templateName}\n\n`;
  output += `## Legend\n`;
  output += `ğŸ”’ Fixed  ğŸ”„ Flexible  âš¡ Urgent  ğŸŒ… AM  ğŸŒ™ PM  ğŸ¥„ Spoon cost\n`;
  output += `âœ… Complete  â³ Incomplete  ğŸ”„ Partial  â­ï¸ Skipped\n\n`;
  
  output += `## Spoon Section\n`;
  output += `| Metric | Value | Notes |\n`;
  output += `|--------|-------|-------|\n`;
  output += `| Baseline | 20 | Chronic pain adjusted baseline |\n`;
  output += `| Spoons borrowed | [pending] | From previous day |\n`;
  output += `| Spoons at start | [auto-calc] | Baseline minus borrowed |\n`;
  output += `| Planned spoon cost | ${tasks.reduce((sum, task) => sum + parseFloat(task.spoons || 0), 0)} | Sum of all tasks |\n`;
  output += `| Spoons spent | 0 | Updates as tasks complete |\n`;
  output += `| Spoons remaining | [auto-calc] | Start minus spent |\n`;
  output += `| Weather | [check local] | Grand Junction, CO |\n\n`;
  
  output += `## Timeline\n`;
  output += `| Time | LMJ | Task Description | Priority | ğŸ¥„ | Status | Area/Notes |\n`;
  output += `|------|-----|------------------|----------|---|--------|------------|\n`;
  
  tasks.forEach(task => {
    if (task.time && task.lmj && task.description) {
      const emoji = LMJ_EMOJIS[task.lmj] || '';
      const typeIcon = task.type === 'Fixed' ? 'ğŸ”’' : task.type === 'Urgent' ? 'âš¡' : 'ğŸ”„';
      output += `| ${task.time} ${typeIcon} | ${task.lmj}${emoji} | ${task.description} (${task.priority}) | ${task.priority} | ${task.spoons} | â³ | ${task.notes} |\n`;
    }
  });
  
  output += `\n## Protocol Notes\n`;
  output += `- All LMJ codes follow protocol-locked order\n`;
  output += `- H always comes after ME\n`;
  output += `- G reserved for Gosling time\n`;
  output += `- Flexible tasks slot between B and G unless specified\n`;
  output += `- All spoon calculations follow chronic pain protocols\n`;
  
  return output;
}

function saveTemplate() {
  const name = document.getElementById('templateName').value;
  if (!name) {
    alert('Please enter a template name');
    return;
  }
  
  const tasks = [];
  const taskRows = document.querySelectorAll('.task-row:not(.task-header)');
  
  taskRows.forEach(row => {
    const inputs = row.querySelectorAll('input, select');
    if (inputs.length >= 7) {
      tasks.push({
        time: inputs[0].value,
        lmj: inputs[1].value,
        description: inputs[2].value,
        priority: inputs[3].value,
        spoons: inputs[4].value,
        type: inputs[5].value,
        notes: inputs[6].value
      });
    }
  });
  
  savedTemplates[name] = {
    type: document.getElementById('templateType').value,
    tasks: tasks,
    created: new Date().toISOString()
  };
  
  localStorage.setItem('spoonpalTemplates', JSON.stringify(savedTemplates));
  refreshTemplateSelect();
  
  showMessage(`Template "${name}" saved successfully!`, 'success');
}

function loadTemplate() {
  const name = document.getElementById('templateSelect').value;
  if (!name || !savedTemplates[name]) {
    alert('Please select a template to load');
    return;
  }
  
  const template = savedTemplates[name];
  document.getElementById('templateName').value = name;
  document.getElementById('templateType').value = template.type;
  
  // Clear existing tasks
  const taskEditor = document.getElementById('taskEditor');
  const existingRows = taskEditor.querySelectorAll('.task-row:not(.task-header)');
  existingRows.forEach(row => row.remove());
  
  // Load template tasks
  template.tasks.forEach(task => {
    addTask(task.time, task.lmj, task.description, task.priority, task.spoons, task.type, task.notes);
  });
  
  showMessage(`Template "${name}" loaded successfully!`, 'success');
}

function exportTemplate() {
  const tasks = [];
  const taskRows = document.querySelectorAll('.task-row:not(.task-header)');
  
  taskRows.forEach(row => {
    const inputs = row.querySelectorAll('input, select');
    if (inputs.length >= 7) {
      tasks.push({
        time: inputs[0].value,
        lmj: inputs[1].value,
        description: inputs[2].value,
        priority: inputs[3].value,
        spoons: inputs[4].value,
        type: inputs[5].value,
        notes: inputs[6].value
      });
    }
  });
  
  const output = generateTemplatePreview(tasks);
  
  navigator.clipboard.writeText(output).then(() => {
    showMessage('Template copied to clipboard! Ready to paste into Academic Allies.', 'success');
  }, () => {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = output;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showMessage('Template copied to clipboard! Ready to paste into Academic Allies.', 'success');
  });
}

function deleteTemplate() {
  const name = document.getElementById('templateSelect').value;
  if (!name || !savedTemplates[name]) {
    alert('Please select a template to delete');
    return;
  }
  
  if (confirm(`Are you sure you want to delete template "${name}"?`)) {
    delete savedTemplates[name];
    localStorage.setItem('spoonpalTemplates', JSON.stringify(savedTemplates));
    refreshTemplateSelect();
    showMessage(`Template "${name}" deleted.`, 'success');
  }
}

function refreshTemplateSelect() {
  const select = document.getElementById('templateSelect');
  select.innerHTML = '<option value="">Select saved template...</option>';
  
  Object.keys(savedTemplates).forEach(name => {
    const option = document.createElement('option');
    option.value = name;
    option.textContent = `${name} (${savedTemplates[name].type})`;
    select.appendChild(option);
  });
}

function showMessage(message, type) {
  const existing = document.querySelector('.message');
  if (existing) existing.remove();
  
  const div = document.createElement('div');
  div.className = `message ${type}`;
  div.textContent = message;
  document.body.insertBefore(div, document.body.firstChild);
  
  setTimeout(() => div.remove(), 3000);
}
</script>

</body>
</html>
