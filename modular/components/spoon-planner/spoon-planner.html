<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpoonPal Protocol Timeline</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .timestamp { 
            font-weight: bold; 
            font-size: 1.1em; 
            margin-bottom: 20px; 
            color: #333; 
        }
        .spoon-section { 
            background: #e8f4fd; 
            padding: 15px; 
            border-radius: 6px; 
            margin-bottom: 20px; 
        }
        .legend { 
            background: #fff3cd; 
            padding: 10px; 
            border-radius: 4px; 
            margin-bottom: 15px; 
            font-family: monospace; 
            font-size: 0.9em; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-bottom: 20px; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: left; 
            font-size: 0.9em; 
        }
        th { 
            background-color: #f8f9fa; 
            font-weight: bold; 
        }
        .reference-section { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 6px; 
            margin-top: 20px; 
            font-family: monospace; 
            font-size: 0.85em; 
        }
        .nonope-log { 
            background: #ffe6e6; 
            padding: 15px; 
            border-radius: 6px; 
            margin-top: 15px; 
            font-family: monospace; 
            font-size: 0.85em; 
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 0.9em; 
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .controls { margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="timestamp" class="timestamp"></div>
        
        <div id="spoonSection" class="spoon-section">
            <h3>Spoon Section (Prefilled)</h3>
            <div>Baseline: <span id="baseline">20</span> | Borrowed: <span id="borrowed">0</span> | Start: <span id="start">20</span></div>
            <div>Planned Cost: <span id="planned">0</span> | Spent: <span id="spent">0</span> | Remaining: <span id="remaining">20</span></div>
            <div>Depletion: <span id="depletion">0</span> | Weather: <span id="weather">[fill]</span> | Check-in: <span id="checkin">[fill]</span></div>
        </div>

        <div class="controls">
            <button class="btn-primary" onclick="generateWeekdayTemplate()">Generate Weekday Template</button>
            <button class="btn-success" onclick="generateSundayTemplate()">Generate Sunday Template</button>
            <button class="btn-warning" onclick="updateSpoons()">Update Spoons</button>
            <button class="btn-danger" onclick="clearTimeline()">Clear Timeline</button>
        </div>

        <div id="legend" class="legend"></div>
        
        <table id="timelineTable">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Lmj</th>
                    <th>Task (Priority)</th>
                    <th>ü•Ñ</th>
                    <th>Status</th>
                    <th>AreaNotes</th>
                </tr>
            </thead>
            <tbody id="timelineBody">
            </tbody>
        </table>

        <div id="referenceSection" class="reference-section"></div>
        <div id="nonopeLog" class="nonope-log"></div>
    </div>

    <script>
        // Protocol-Locked LMJ Order and Emojis (from attached file)
        const LOCKED_LMJ_ORDER = [
            { lmj: 'A', emoji: 'üíä', description: 'Morning meds' },
            { lmj: 'V', emoji: 'ü¶æ', description: 'CPAP prep, wrist brace' },
            { lmj: 'B', emoji: 'üçΩÔ∏è', description: 'Family scriptures, breakfast' },
            { lmj: 'G', emoji: 'üê•', description: 'Gosling time' },
            { lmj: 'N', emoji: 'üì∞', description: 'News with Mom' },
            { lmj: 'ME', emoji: 'üßò', description: 'Me time' },
            { lmj: 'H', emoji: 'üß∫', description: 'Hamper/laundry (change clothes, hamper, bathroom)' },
            { lmj: 'CC', emoji: 'üõèÔ∏è', description: 'In bed' },
            { lmj: 'DD', emoji: 'üí®', description: 'Breathe, recover' },
            { lmj: 'EE', emoji: 'üò∑', description: 'CPAP mask on' },
            { lmj: 'FF', emoji: 'ü§ö', description: 'Wrist brace on' },
            { lmj: 'ZZ', emoji: 'üìµ', description: 'Device off, crash' }
        ];

        // Protocol-Locked Status Icons (‚è≠Ô∏è is EXPRESSLY FORBIDDEN)
        const STATUS_ICONS = {
            complete: '‚úÖ',
            incomplete: '‚¨ú',
            partial: '‚è≥',
            progress: 'üõ†Ô∏è',
            interrupted: 'üöß', 
            skipped: '‚ùå',  // NOT ‚è≠Ô∏è which is forbidden
            rescheduled: 'üîÑ'
        };

        // Protocol-Locked Legend
        const LEGEND = "Fixed üîí Flexible ‚ÜïÔ∏è Urgent üî• AM ‚òÄÔ∏è PM üåô ü•Ñ Spoon Lmj üéØ Status ‚úÖ Complete ‚¨ú Incomplete ‚è≥ Partial üõ†Ô∏è Progress üöß Interrupted ‚ùå Skipped üîÑ Rescheduled";

        // Global timeline data
        let timelineData = [];
        let bbCounter = 1; // For bathroom break emoji tracking

        // Initialize app
        function init() {
            updateTimestamp();
            updateLegend();
            updateReferenceSection();
            updateNonopeLog();
            setInterval(updateTimestamp, 60000); // Update every minute
        }

        // Update timestamp (MUST be first line per protocol)
        function updateTimestamp() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
                timeZoneName: 'short'
            };
            document.getElementById('timestamp').textContent = now.toLocaleDateString('en-US', options);
        }

        // Update legend (must appear above table AND in reference section)
        function updateLegend() {
            document.getElementById('legend').textContent = LEGEND;
        }

        // Generate weekday template following locked LMJ order
        function generateWeekdayTemplate() {
            timelineData = [
                { time: '0730', ampm: 'AM', fixed: true, lmj: 'A', emoji: 'üíä', description: 'Morning meds (High)', spoonCost: 2, status: 'incomplete', notes: 'Essential start' },
                { time: '0745', ampm: 'AM', fixed: true, lmj: 'V', emoji: 'ü¶æ', description: 'CPAP prep, wrist brace (High)', spoonCost: 1, status: 'incomplete', notes: 'Morning routine' },
                { time: '0800', ampm: 'AM', fixed: true, lmj: 'B', emoji: 'üçΩÔ∏è', description: 'Family scriptures, breakfast (High)', spoonCost: 2, status: 'incomplete', notes: 'Kitchen, hydrate' },
                { time: '0900', ampm: 'AM', fixed: false, lmj: 'G', emoji: 'üê•', description: 'Gosling time (Medium)', spoonCost: 2, status: 'incomplete', notes: 'Outdoor time' },
                { time: '1000', ampm: 'AM', fixed: false, lmj: 'BB1', emoji: 'üöΩ', description: 'Bathroom break (High)', spoonCost: 0, status: 'incomplete', notes: 'First BB of day' },
                { time: '1200', ampm: 'PM', fixed: false, lmj: 'L1', emoji: 'üçΩÔ∏è', description: 'Lunch (High)', spoonCost: 1, status: 'incomplete', notes: 'Kitchen, hydrate' },
                { time: '0200', ampm: 'PM', fixed: false, lmj: 'BB2', emoji: 'üöª', description: 'Bathroom break (High)', spoonCost: 0, status: 'incomplete', notes: 'Second BB, unique emoji' },
                { time: '0600', ampm: 'PM', fixed: false, lmj: 'N', emoji: 'üì∞', description: 'News with Mom (High)', spoonCost: 1, status: 'incomplete', notes: 'Evening routine' },
                { time: '0700', ampm: 'PM', fixed: false, lmj: 'ME', emoji: 'üßò', description: 'Me time (Medium)', spoonCost: 1, status: 'incomplete', notes: 'Relaxation' },
                { time: '0800', ampm: 'PM', fixed: false, lmj: 'H', emoji: 'üß∫', description: 'Hamper/laundry (Medium)', spoonCost: 1, status: 'incomplete', notes: 'Change clothes, bathroom' },
                { time: '0900', ampm: 'PM', fixed: true, lmj: 'CC', emoji: 'üõèÔ∏è', description: 'In bed (High)', spoonCost: 0, status: 'incomplete', notes: 'Settle in' },
                { time: '0915', ampm: 'PM', fixed: true, lmj: 'DD', emoji: 'üí®', description: 'Breathe, recover (High)', spoonCost: 0, status: 'incomplete', notes: 'Post-movement rest' },
                { time: '0930', ampm: 'PM', fixed: true, lmj: 'EE', emoji: 'üò∑', description: 'CPAP mask on (High)', spoonCost: 0, status: 'incomplete', notes: 'Sleep prep' },
                { time: '0945', ampm: 'PM', fixed: true, lmj: 'FF', emoji: 'ü§ö', description: 'Wrist brace on (High)', spoonCost: 0, status: 'incomplete', notes: 'If needed' },
                { time: '1000', ampm: 'PM', fixed: true, lmj: 'ZZ', emoji: 'üìµ', description: 'Device off, crash (High)', spoonCost: 0, status: 'incomplete', notes: 'Sleep initiation' }
            ];
            
            calculateSpoons();
            renderTimeline();
        }

        // Generate Sunday template (restricted per protocol)
        function generateSundayTemplate() {
            timelineData = [
                { time: '0730', ampm: 'AM', fixed: true, lmj: 'A', emoji: 'üíä', description: 'Morning meds (High)', spoonCost: 2, status: 'incomplete', notes: 'Essential' },
                { time: '1130', ampm: 'AM', fixed: true, lmj: 'CH', emoji: '‚õ™', description: 'Church service (Highest)', spoonCost: 3, status: 'incomplete', notes: 'Fixed slot, locked' },
                { time: '0600', ampm: 'PM', fixed: false, lmj: 'N', emoji: 'üì∞', description: 'News with Mom (High)', spoonCost: 1, status: 'incomplete', notes: 'Evening routine' },
                { time: '0900', ampm: 'PM', fixed: true, lmj: 'CC', emoji: 'üõèÔ∏è', description: 'In bed (High)', spoonCost: 0, status: 'incomplete', notes: 'Settle in' },
                { time: '1000', ampm: 'PM', fixed: true, lmj: 'ZZ', emoji: 'üìµ', description: 'Device off, crash (High)', spoonCost: 0, status: 'incomplete', notes: 'Sleep initiation' }
            ];
            
            calculateSpoons();
            renderTimeline();
        }

        // Calculate spoon metrics
        function calculateSpoons() {
            const baseline = 20;
            const borrowed = 0; // Update based on deficit
            const start = baseline - borrowed;
            const planned = timelineData.reduce((sum, task) => sum + task.spoonCost, 0);
            const spent = timelineData.filter(task => task.status === 'complete').reduce((sum, task) => sum + task.spoonCost, 0);
            const remaining = start - spent;
            const depletion = remaining - (planned - spent);

            document.getElementById('baseline').textContent = baseline;
            document.getElementById('borrowed').textContent = borrowed;
            document.getElementById('start').textContent = start;
            document.getElementById('planned').textContent = planned;
            document.getElementById('spent').textContent = spent;
            document.getElementById('remaining').textContent = remaining;
            document.getElementById('depletion').textContent = depletion;
        }

        // Render timeline table
        function renderTimeline() {
            const tbody = document.getElementById('timelineBody');
            tbody.innerHTML = '';

            timelineData.forEach((task, index) => {
                const row = document.createElement('tr');
                
                // Time column with icons
                const timeCell = document.createElement('td');
                const timeIcon = task.ampm === 'AM' ? '‚òÄÔ∏è' : 'üåô';
                const flexIcon = task.fixed ? 'üîí' : '‚ÜïÔ∏è';
                timeCell.textContent = `${task.time} ${timeIcon} ${flexIcon}`;
                row.appendChild(timeCell);

                // Lmj column
                const lmjCell = document.createElement('td');
                lmjCell.textContent = `${task.lmj}${task.emoji}`;
                row.appendChild(lmjCell);

                // Task description
                const taskCell = document.createElement('td');
                taskCell.textContent = task.description;
                row.appendChild(taskCell);

                // Spoon cost
                const spoonCell = document.createElement('td');
                spoonCell.textContent = task.spoonCost;
                row.appendChild(spoonCell);

                // Status
                const statusCell = document.createElement('td');
                statusCell.textContent = STATUS_ICONS[task.status];
                statusCell.style.cursor = 'pointer';
                statusCell.onclick = () => toggleStatus(index);
                row.appendChild(statusCell);

                // Area notes
                const notesCell = document.createElement('td');
                notesCell.textContent = task.notes;
                row.appendChild(notesCell);

                tbody.appendChild(row);
            });

            calculateSpoons();
        }

        // Toggle task status
        function toggleStatus(index) {
            const statuses = ['incomplete', 'partial', 'progress', 'complete', 'skipped'];
            const currentIndex = statuses.indexOf(timelineData[index].status);
            const nextIndex = (currentIndex + 1) % statuses.length;
            timelineData[index].status = statuses[nextIndex];
            renderTimeline();
        }

        // Update spoons manually
        function updateSpoons() {
            const weather = prompt("Enter weather:");
            const checkin = prompt("Enter check-in status:");
            const borrowed = prompt("Enter borrowed spoons (default 0):", "0");
            
            if (weather) document.getElementById('weather').textContent = weather;
            if (checkin) document.getElementById('checkin').textContent = checkin;
            if (borrowed) document.getElementById('borrowed').textContent = borrowed;
            
            calculateSpoons();
        }

        // Clear timeline
        function clearTimeline() {
            if (confirm("Clear all timeline data?")) {
                timelineData = [];
                renderTimeline();
            }
        }

        // Update reference section (must include legend)
        function updateReferenceSection() {
            const referenceHTML = `
                <h4>Reference Section (System Use Only, Always Last)</h4>
                <div><strong>Legend:</strong> ${LEGEND}</div>
                <div><strong>Protocol Notes:</strong></div>
                <ul>
                    <li>H comes after ME in locked LMJ order</li>
                    <li>Evening routines (N, ME, H, CC, DD, EE, FF, ZZ) cannot move ahead of G</li>
                    <li>Multiple BBs per day require unique emojis</li>
                    <li>Only one BB per day can use standard üöΩ emoji</li>
                    <li>All other tasks must be slotted between B and G unless specified</li>
                    <li>Label-RuleDescription.csv and user corrections always referenced</li>
                </ul>
            `;
            document.getElementById('referenceSection').innerHTML = referenceHTML;
        }

        // Update NONOPE log
        function updateNonopeLog() {
            const nonopeHTML = `
                <h4>NONOPE Log</h4>
                <ul>
                    <li>Use of ‚è≠Ô∏è icon for Skipped status is EXPRESSLY FORBIDDEN</li>
                    <li>Any drift, unordered LMJs, H before ME permanently rejected</li>
                    <li>Duplicate BB emojis in same day permanently rejected</li>
                    <li>Any timeline not following locked LMJ order permanently rejected</li>
                </ul>
            `;
            document.getElementById('nonopeLog').innerHTML = nonopeHTML;
        }

        // Initialize when page loads
        window.onload = init;
    </script>
</body>
</html>
