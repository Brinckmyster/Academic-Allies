<header class="site-header" role="banner">
  <div class="header-content">
    <a aria-label="Home" class="home-link" href="/Academic-Allies/" title="Go Home">
    <img alt="Home" class="home-icon" src="/Academic-Allies/modular/icons/home.png" width="48" height="48" title="Academic Allies Home"/>
    </a>
      <span class="tagline" title="Academic Allies
Your disability accommodations and support network">Your disability accommodations and support network</span>
    <nav aria-label="Main navigation">
      <ul class="nav-list">
        <li><a href="/Academic-Allies/modular/components/calendar/calendar.html" title="Calendar">Calendar</a></li>
        <li><a href="/Academic-Allies/modular/components/message-system/message-system.html" title="Messages">Messages</a></li>
        <li><a href="/Academic-Allies/modular/emergency.html" title="Emergency Contact">Emergency Contact</a></li>
        <li><a href="/Academic-Allies/modular/checkin.html" title="Daily Check-In">Daily Check-In</a></li>
        <li><a href="/Academic-Allies/modular/icon-gallery.html" title="Icon Gallery">Icon Gallery</a></li>
        <li><a href="/Academic-Allies/modular/static/sitemap.html" title="Site Map">Site Map</a></li>
      </ul>
    </nav>
    <div style="display:flex;gap:10px;align-items:center;margin-left:20px;flex-wrap:wrap;">
      <span style="font-weight:600;color:#555;">Mode:</span>
      <a href="/Academic-Allies/" style="padding:8px 12px;background:#6CA0A3;color:#fff;text-decoration:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;"><img src="/Academic-Allies/modular/icons/mode-normal-outline.png" width="20" height="20" alt="Normal">Normal</a>
      <a href="/Academic-Allies/modular/components/recovery-mode.html" style="padding:8px 12px;background:#6CA0A3;color:#fff;text-decoration:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;"><img src="/Academic-Allies/modular/icons/mode-recovery.png" width="20" height="20" alt="Recovery">Recovery</a>
      <button onclick="alert('Bad Brain Day mode coming soon!')" style="padding:8px 12px;background:#999;color:#fff;border:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;cursor:pointer;"><img src="/Academic-Allies/modular/icons/mode-bad-brain-perplexity.png" width="20" height="20" alt="Bad Brain">Bad Brain</button>
      <a href="/Academic-Allies/modular/nope-mode.html" style="padding:8px 12px;background:#6CA0A3;color:#fff;text-decoration:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;"><img src="/Academic-Allies/modular/icons/mode-semi-nope-shadow.png" width="20" height="20" alt="Semi-Nope">Semi-Nope</a>
      <a href="/Academic-Allies/modular/nope-mode.html" style="padding:8px 12px;background:#c0392b;color:#fff;text-decoration:none;border-radius:6px;display:inline-flex;align-items:center;gap:6px;font-size:14px;font-weight:700;"><img src="/Academic-Allies/modular/icons/mode-nope-button.png" width="20" height="20" alt="Nope">NOPE</a>
    </div>

    <div class="header-controls">
      <!-- User Info Display (hidden until signed in) -->
      <div id="userInfoDisplay" style="display: none; margin-right: 10px; align-items: center; gap: 7px;">
        <img id="userTierIcon" src="" alt="" width="28" height="28"
          style="border-radius:50%;object-fit:cover;display:none;vertical-align:middle;">
        <span id="userNameDisplay"></span>
      </div>

      <!-- Firebase Sign-In Button (hidden once signed in) -->
      <button id="aa-signin-btn" title="Sign in with Google"
        style="display:inline-flex;align-items:center;gap:8px;padding:7px 14px;background:#fff;color:#444;border:1px solid #dadce0;border-radius:4px;font-size:13px;font-weight:500;cursor:pointer;box-shadow:0 1px 2px rgba(0,0,0,0.1);">
        <svg width="16" height="16" viewBox="0 0 18 18" aria-hidden="true"><path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"/><path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z"/><path fill="#FBBC05" d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z"/><path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 6.29C4.672 4.163 6.656 3.58 9 3.58z"/></svg>
        Sign in with Google
      </button>

      <!-- Admin Panel Button (shown only for admins) -->
      <a id="adminPanelBtn" href="/Academic-Allies/modular/admin.html" title="Admin Panel" style="display:none;align-items:center;gap:6px;padding:7px 13px;background:#4a7f82;color:#fff;text-decoration:none;border-radius:6px;font-size:13px;font-weight:600;border:none;">
        <img src="https://brinckmyster.github.io/Academic-Allies/modular/icons/badge-admin-icon.png" width="18" height="18" alt="" style="vertical-align:middle;">
        Admin
      </a>

      <!-- Sign Out Button (hidden until signed in) -->
      <button id="signOutButton" style="display: none;">Sign Out</button>

      <!-- JS-Draggable Status Circle -->
      <div aria-label="Status: Not signed in" id="status-circle" tabindex="0" title="Click to toggle status, drag to reorder"></div>
    </div>
  </div>

  <!-- Status Circle Container -->
  <div aria-live="polite" id="status-circle-container" role="status" title="Authentication Status"></div>

  <!-- ── Firebase Auth (single source of truth for all pages) ── -->
  <!-- Sequential loader: skips SDK loading if the page already loaded Firebase
       (e.g. admin.html loads it in <head>). Works the same on every page. -->
  <script>
  (function () {
    'use strict';
    var FB_BASE   = 'https://www.gstatic.com/firebasejs/9.23.0/';
    var AA_JS     = '/Academic-Allies/modular/aa-firebase.js?v=20260220f'; /* Updated: 2026-02-20 by Claude — Admin Panel button in header */

    /* ── 3. Wire up the header UI once window.AA is ready ── */
    function initAuthUI() {
      if (!window.AA || !window.AA.auth) { setTimeout(initAuthUI, 100); return; }

      var signinBtn    = document.getElementById('aa-signin-btn');
      var infoWrap     = document.getElementById('userInfoDisplay');
      var nameEl       = document.getElementById('userNameDisplay');
      var tierIconEl   = document.getElementById('userTierIcon');
      var signoutBtn   = document.getElementById('signOutButton');
      var adminBtn     = document.getElementById('adminPanelBtn');

      /* Tier icon map */
      var TIER_ICONS = {
        'admin':       '/Academic-Allies/modular/icons/icon-user-admin.png',
        'student':     '/Academic-Allies/modular/icons/icon-user-student.png',
        'support':     '/Academic-Allies/modular/icons/icon-user-support.png',
        'nearby-help': '/Academic-Allies/modular/icons/icon-user-nearby-help.png',
        'family':      '/Academic-Allies/modular/icons/icon-user-family.png'
      };

      function setTierIcon(role) {
        if (!tierIconEl) return;
        var src = TIER_ICONS[role] || TIER_ICONS['student'];
        tierIconEl.src = src;
        tierIconEl.alt = role;
        tierIconEl.style.display = 'inline-block';
        tierIconEl.onerror = function () { tierIconEl.style.display = 'none'; };
      }

      /* Sign-in click → Firebase Google popup */
      if (signinBtn) {
        signinBtn.addEventListener('click', function () {
          signinBtn.disabled    = true;
          signinBtn.textContent = 'Signing in…';
          window.AA.signInWithGoogle().catch(function (err) {
            console.error('[AA header] sign-in error:', err);
            signinBtn.disabled    = false;
            signinBtn.innerHTML   = '&#x25B6; Sign in with Google';
          });
        });
      }

      /* Sign-out click */
      if (signoutBtn) {
        signoutBtn.addEventListener('click', function () {
          sessionStorage.removeItem('academicAlliesUser');
          window.AA.signOut();
        });
      }

      /* React to every auth state change */
      window.AA.auth.onAuthStateChanged(function (user) {
        if (!user) {
          if (signinBtn)  { signinBtn.style.display = 'inline-flex'; signinBtn.disabled = false; }
          if (infoWrap)   infoWrap.style.display   = 'none';
          if (signoutBtn) signoutBtn.style.display  = 'none';
          if (adminBtn)   adminBtn.style.display    = 'none';
          return;
        }

        /* Look up role in Firestore */
        window.AA.db.collection('users').doc(user.uid).get()
          .then(function (doc) {
            var data    = doc.exists ? doc.data() : {};
            var role    = data.role || 'student';
            var isAdmin = (role === 'admin');
            var first   = (user.displayName || user.email || '').split(' ')[0];

            if (signinBtn)  signinBtn.style.display  = 'none';
            if (infoWrap)   infoWrap.style.display   = 'flex';
            if (nameEl)     nameEl.textContent = first;
            if (adminBtn)   adminBtn.style.display   = isAdmin ? 'inline-flex' : 'none';
            if (signoutBtn) signoutBtn.style.display  = 'inline-block';
            setTierIcon(role);

            /* Show role-specific cards on home page — updated 2026-02-20 by Claude */
            var adminCard       = document.getElementById('adminCard');
            var spoonpalCard    = document.getElementById('spoonpalCard');
            var supportDashCard = document.getElementById('supportDashCard');
            var isSupportRole   = ['support','family','nearby-help'].indexOf(role) !== -1;
            // isSupporter flag: student who is also in someone else's support network
            var isStudentSupporter = (role === 'student' && data.isSupporter === true);
            if (adminCard       && isAdmin)                        adminCard.style.display       = 'flex';
            if (spoonpalCard    && isAdmin)                        spoonpalCard.style.display    = 'flex';
            if (supportDashCard && (isSupportRole || isStudentSupporter)) supportDashCard.style.display = 'flex';

            /* Keep sessionStorage for any pages still reading it */
            try {
              sessionStorage.setItem('academicAlliesUser', JSON.stringify({
                name: user.displayName, email: user.email, role: role
              }));
            } catch (e) {}
          })
          .catch(function () {
            /* Firestore unavailable — show name, student icon as fallback */
            var first = (user.displayName || user.email || '').split(' ')[0];
            if (signinBtn)  signinBtn.style.display  = 'none';
            if (infoWrap)   infoWrap.style.display   = 'flex';
            if (nameEl)     nameEl.textContent = first;
            if (signoutBtn) signoutBtn.style.display  = 'inline-block';
            setTierIcon('student');
          });
      });
    }

    /* ── 2. Load aa-firebase.js after SDKs are ready ──────── */
    function loadAAFirebase() {
      if (window.AA && window.AA.auth) { initAuthUI(); return; }
      var s = document.createElement('script');
      s.src    = AA_JS;
      s.onload = initAuthUI;
      s.onerror = function () { console.error('[AA header] Cannot load aa-firebase.js'); };
      document.head.appendChild(s);
    }

    /* ── 1. Load Firebase SDKs if the page hasn't loaded them ─ */
    function loadSDKs() {
      if (window.firebase && window.AA)     { initAuthUI();    return; }
      if (window.firebase && !window.AA)   { loadAAFirebase(); return; }
      var sdks = ['firebase-app-compat.js','firebase-auth-compat.js','firebase-firestore-compat.js'];
      var i = 0;
      function next() {
        if (i >= sdks.length) { loadAAFirebase(); return; }
        var s = document.createElement('script');
        s.src = FB_BASE + sdks[i++]; s.onload = next;
        document.head.appendChild(s);
      }
      next();
    }

    loadSDKs();
  })();
  </script>
<script src="/Academic-Allies/modular/js/draggable.js"></script>
<script src="/Academic-Allies/modular/js/status-circle.js"></script>
  <!-- auth-system.js retired 2026-02-20 — was creating duplicate 'pending' user docs
       and conflicting with aa-firebase.js. Archived as archive/auth-system-RETIRED-*.js -->
</header>

<style>
.site-header {
  background: #f8f9fa;
  border-bottom: 1px solid #e1e5e9;
  padding: 12px 20px;
}

.header-content {
  justify-content: flex-start;
  align-items: center;
  max-width: 1200px;
  margin: 0 auto;
}

.home-link {
  display: flex;
  align-items: center;
  text-decoration: none;
  color: #333;
  font-weight: 600;
}

.home-link:hover {
  color: #0066cc;
}

.home-icon {
  margin-right: 8px;
}

.nav-list {
  display: flex;
  list-style: none;
  margin: 0;
  padding: 0;
  gap: 20px;
}

.nav-list li {
  margin: 0;
}

.nav-list a {
  text-decoration: none;
  color: #555;
  font-weight: 500;
  padding: 8px 12px;
  border-radius: 4px;
  transition: background-color 0.2s;
}

.nav-list a:hover {
  background-color: #e9ecef;
  color: #333;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 15px;
}

#userInfoDisplay {
  font-weight: 500;
  color: #333;
}

#signOutButton {
  padding: 8px 16px;
  background-color: #dc3545;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 500;
}

#signOutButton:hover {
  background-color: #c82333;
}

#status-circle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background-color: #9E9E9E; /* grey = default, status-circle.js will update */
  cursor: grab;
  position: fixed; top: 16px; right: 16px; z-index: 1000;
  transition: background-color 0.3s, border-color 0.3s;
}

/* ── Attribution footer (all screen sizes) ──────────────── */
#aa-credit-footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(248,250,252,0.92);
  border-top: 1px solid #e1e5e9;
  padding: 4px 16px;
  font-size: 10px;
  color: #999;
  text-align: center;
  z-index: 500;
  backdrop-filter: blur(4px);
  letter-spacing: 0.3px;
}
#aa-credit-footer a { color: #6CA0A3; text-decoration: none; }
#aa-credit-footer a:hover { text-decoration: underline; }

@media (max-width: 768px) {
  .header-content {
    justify-content: flex-start;
    gap: 15px;
  }

  .nav-list {
    flex-wrap: wrap;
    justify-content: flex-start;
    gap: 10px;
  }
}</style>

<!-- ── Attribution footer ───────────────────────────────── -->
<div id="aa-credit-footer">
  Built with <a href="https://www.perplexity.ai" target="_blank" rel="noopener">Perplexity AI</a>
  &nbsp;·&nbsp; Icons &amp; assets assisted by Perplexity
  &nbsp;·&nbsp; Code &amp; automation by <a href="https://claude.ai" target="_blank" rel="noopener">Claude</a>
</div>
