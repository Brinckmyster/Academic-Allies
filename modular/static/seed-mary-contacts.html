<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Seed Mary's Emergency Contacts</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; background: #1a1a2e; color: #eee; }
    h1 { color: #6CA0A3; }
    .contact { background: #2a2a3e; border-radius: 8px; padding: 1rem; margin: .75rem 0; }
    .contact h3 { margin: 0 0 .4rem; color: #a8d8da; }
    button { background: #6CA0A3; color: #fff; border: none; border-radius: 8px; padding: .75rem 2rem; font-size: 1rem; cursor: pointer; margin-top: 1rem; }
    button:disabled { opacity: .5; cursor: default; }
    #status { margin-top: 1rem; padding: 1rem; border-radius: 8px; display: none; }
    .ok  { background: #1a3a1a; color: #4caf50; }
    .err { background: #3a1a1a; color: #ef5350; }
    .warn { color: #ffa726; font-size: .85rem; margin-top: .5rem; }
  </style>
</head>
<body>
  <h1>üå∏ Seed Mary's Emergency Contacts</h1>
  <p>One-time admin tool. Must be signed in as <strong>brinckmyster@gmail.com</strong>.</p>
  <p>This will write the following contacts to Mary's private Firestore record:</p>

  <div class="contact"><h3>üë© Mom ‚Äî Dorothy Brinck</h3>Family ¬∑ (661) 400-2545 ¬∑ Dorothy.brinck@gmail.com</div>
  <div class="contact"><h3>üë® Dad ‚Äî Brian Brinck</h3>Family ¬∑ (661) 878-2414 ¬∑ Brian.e.brinck@gmail.com</div>
  <div class="contact"><h3>üíô Susan Gleason</h3>Support Professional ¬∑ +1 (803) 548-4296</div>
  <div class="contact"><h3>üè† Brinc (Admin)</h3>Nearby Help ¬∑ (661) 429-7477 ¬∑ brinckmyster@gmail.com</div>

  <p class="warn">‚ö†Ô∏è This will OVERWRITE any contacts already saved for Mary. Only run once.</p>
  <button id="seed-btn" onclick="seedContacts()">Write Contacts to Firestore</button>
  <div id="status"></div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="/Academic-Allies/modular/aa-firebase.js"></script>
  <script>
    var MARY_EMAIL = 'mbrinck90@gmail.com';

    var CONTACTS = [
      { name: 'Dorothy Brinck', relationship: 'Mom', type: 'family',    phone: '661-400-2545',    email: 'Dorothy.brinck@gmail.com', message: '', photo: '' },
      { name: 'Brian Brinck',   relationship: 'Dad', type: 'family',    phone: '661-878-2414',    email: 'Brian.e.brinck@gmail.com',  message: '', photo: '' },
      { name: 'Susan Gleason',  relationship: 'Support Professional', type: 'support',   phone: '+18035484296', email: '', message: '', photo: '' },
      { name: 'Brinc',          relationship: 'Admin / Nearby Help',  type: 'nearby',    phone: '661-429-7477', email: 'brinckmyster@gmail.com', message: '', photo: '' }
    ];

    function setStatus(msg, cls) {
      var el = document.getElementById('status');
      el.textContent = msg;
      el.className = cls;
      el.style.display = 'block';
    }

    function seedContacts() {
      var btn = document.getElementById('seed-btn');
      btn.disabled = true;
      setStatus('Checking auth‚Ä¶', '');

      AA.auth.onAuthStateChanged(function(user) {
        if (!user) { setStatus('‚ùå Not signed in. Sign in to Academic Allies first, then come back here.', 'err'); btn.disabled = false; return; }
        if (user.email !== 'brinckmyster@gmail.com') { setStatus('‚ùå Must be signed in as brinckmyster@gmail.com (you are ' + user.email + ')', 'err'); btn.disabled = false; return; }

        setStatus('Looking up Mary\'s account‚Ä¶', '');

        AA.db.collection('users').where('email', '==', MARY_EMAIL).limit(1).get()
          .then(function(snap) {
            if (snap.empty) {
              return AA.db.collection('users').get().then(function(all) {
                var found = null;
                all.forEach(function(d) {
                  var data = d.data();
                  if ((data.email || '').toLowerCase() === MARY_EMAIL.toLowerCase()) found = d.id;
                });
                return found;
              });
            }
            return snap.docs[0].id;
          })
          .then(function(maryUid) {
            if (!maryUid) { setStatus('‚ùå Could not find Mary\'s account (mbrinck90@gmail.com) in Firestore.', 'err'); btn.disabled = false; return; }
            setStatus('Found Mary (uid: ' + maryUid + '). Writing contacts‚Ä¶', '');

            return AA.db.collection('emergencyContacts').doc(maryUid).set({
              contacts:  CONTACTS,
              updatedBy: user.uid,
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
          })
          .then(function() {
            setStatus('‚úÖ Done! Mary\'s 4 contacts have been saved privately to Firestore. You can delete this page now.', 'ok');
          })
          .catch(function(err) {
            setStatus('‚ùå Error: ' + err.message, 'err');
            btn.disabled = false;
          });
      });
    }
  </script>
</body>
</html>
