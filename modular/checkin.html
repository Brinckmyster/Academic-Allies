<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Check-In ‚Äî Academic Allies</title>
  <!-- Updated: 2026-02-25 by Claude ‚Äî full 5-category gateway check-in per confirmed Grok spec + Mary's energy scale -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400&display=swap" />
  <style>
    /* ‚îÄ‚îÄ Base ‚îÄ‚îÄ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --teal:    #6CA0A3;
      --teal-dk: #4d787b;
      --bg:      #FAFAF9;
      --card:    #FFFFFF;
      --border:  #D9E4E5;
      --text:    #1a1a1a;
      --muted:   #5a6a6b;
      --green:   #28a745;
      --yellow:  #ffc107;
      --orange:  #fd7e14;
      --red:     #dc3545;
      --radius:  12px;
      --shadow:  0 2px 8px rgba(0,0,0,.08);
    }
    body {
      font-family: 'Atkinson Hyperlegible', sans-serif;
      background: var(--bg);
      color: var(--text);
      font-size: 1rem;
      line-height: 1.6;
      padding-bottom: 3rem;
    }
    body.high-contrast { background:#000; color:#fff; }
    body.high-contrast .card { background:#111; border-color:#fff; }
    body.dyslexia-font { font-family: 'OpenDyslexic', sans-serif; }
    body.reduced-motion * { transition: none !important; animation: none !important; }

    /* ‚îÄ‚îÄ Header placeholder ‚îÄ‚îÄ */
    #shared-header { min-height: 56px; }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .page-wrap {
      max-width: 680px;
      margin: 0 auto;
      padding: 1rem 1rem 2rem;
    }
    h1 {
      font-size: 1.5rem;
      color: var(--teal-dk);
      margin: 1rem 0 .25rem;
    }
    .subtitle { color: var(--muted); font-size: .9rem; margin-bottom: 1.25rem; }

    /* ‚îÄ‚îÄ Cards ‚îÄ‚îÄ */
    .card {
      background: var(--card);
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1.25rem 1.25rem 1rem;
      margin-bottom: 1rem;
    }
    .card h2 {
      font-size: 1.1rem;
      color: var(--teal-dk);
      margin-bottom: .35rem;
    }
    .card .gateway-q {
      font-size: 1rem;
      font-weight: 700;
      margin: .5rem 0 .25rem;
    }
    .reassurance {
      font-size: .85rem;
      color: var(--muted);
      margin-bottom: .75rem;
      font-style: italic;
    }

    /* ‚îÄ‚îÄ Gateway row ‚îÄ‚îÄ */
    .gw-row { display: flex; gap: .5rem; flex-wrap: wrap; margin-bottom: .5rem; }
    .gw-btn {
      flex: 1; min-width: 80px;
      padding: .55rem .5rem;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: #fff;
      font-family: inherit;
      font-size: .95rem;
      font-weight: 700;
      cursor: pointer;
      transition: background .15s, border-color .15s, color .15s;
    }
    .gw-btn:hover { border-color: var(--teal); }
    .gw-btn.sel-yes  { background: #e6f4ea; border-color: var(--green);  color: #155724; }
    .gw-btn.sel-no   { background: #fff3cd; border-color: var(--yellow); color: #856404; }
    .gw-btn.sel-skip { background: #f0f0f0; border-color: #aaa;         color: #555;    }

    /* ‚îÄ‚îÄ Expand sections ‚îÄ‚îÄ */
    .expand { display: none; margin-top: .75rem; }
    .expand.open { display: block; }
    .expand h3 { font-size: .95rem; color: var(--muted); margin-bottom: .5rem; }

    /* ‚îÄ‚îÄ Checklist ‚îÄ‚îÄ */
    .checklist { list-style: none; padding: 0; }
    .checklist li { margin-bottom: .4rem; }
    .checklist label {
      display: flex; align-items: flex-start; gap: .5rem;
      cursor: pointer; font-size: .95rem;
    }
    .checklist input[type=checkbox] { margin-top: .15rem; flex-shrink: 0; accent-color: var(--teal); }

    /* ‚îÄ‚îÄ Emoji row ‚îÄ‚îÄ */
    .emoji-row {
      display: flex; flex-wrap: wrap; gap: .35rem;
      margin: .75rem 0 .5rem;
    }
    .emoji-btn {
      display: flex; flex-direction: column; align-items: center;
      padding: .35rem .4rem;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
      font-size: .8rem;
      text-align: center;
      min-width: 56px;
      transition: border-color .15s, background .15s;
      font-family: inherit;
    }
    .emoji-btn .em { font-size: 1.4rem; line-height: 1.2; }
    .emoji-btn .lbl { font-size: .65rem; color: var(--muted); line-height: 1.2; margin-top: .1rem; }
    .emoji-btn:hover { border-color: var(--teal); }
    .emoji-btn.sel-g { background: #e6f4ea; border-color: var(--green); }
    .emoji-btn.sel-y { background: #fff9e6; border-color: var(--yellow); }
    .emoji-btn.sel-o { background: #fff3e0; border-color: var(--orange); }
    .emoji-btn.sel-r { background: #fde8ea; border-color: var(--red); }

    /* BBD mode ‚Äî bigger emoji */
    body.bbd-active .emoji-btn { min-width: 70px; padding: .5rem; }
    body.bbd-active .emoji-btn .em { font-size: 1.8rem; }
    body.bbd-active .expand h3,
    body.bbd-active .checklist,
    body.bbd-active .reassurance { display: none; }
    body.bbd-active .expand.open { padding-top: 0; }

    /* ‚îÄ‚îÄ Note fields ‚îÄ‚îÄ */
    .note-wrap { margin-top: .6rem; }
    .note-wrap label { font-size: .85rem; color: var(--muted); display: block; margin-bottom: .25rem; }
    .note-wrap textarea {
      width: 100%; border: 1.5px solid var(--border); border-radius: 8px;
      padding: .5rem; font-family: inherit; font-size: .9rem;
      resize: vertical; min-height: 60px; background: var(--bg);
    }

    /* ‚îÄ‚îÄ Thumping banner ‚îÄ‚îÄ */
    #thumping-banner {
      display: none;
      background: #fff3cd; border: 2px solid var(--yellow);
      border-radius: 8px; padding: .75rem 1rem;
      font-size: .9rem; color: #856404;
      margin-bottom: 1rem;
    }
    #thumping-banner.show { display: block; }

    /* ‚îÄ‚îÄ Flag indicator ‚îÄ‚îÄ */
    #flag-bar {
      display: none;
      border-radius: 8px; padding: .6rem 1rem;
      font-size: .9rem; font-weight: 700;
      margin-bottom: 1rem;
      border: 2px solid transparent;
    }
    #flag-bar.show { display: block; }
    #flag-bar.flag-g { background:#e6f4ea; border-color:var(--green);  color:#155724; }
    #flag-bar.flag-y { background:#fff9e6; border-color:var(--yellow); color:#856404; }
    #flag-bar.flag-o { background:#fff3e0; border-color:var(--orange); color:#7a3e00; }
    #flag-bar.flag-r { background:#fde8ea; border-color:var(--red);    color:#721c24; }

    /* ‚îÄ‚îÄ Bad Brain Day toggle card ‚îÄ‚îÄ */
    #bbd-card { border-color: #6CA0A3; }
    #bbd-card h2 { color: #4d787b; }
    .bbd-toggle-row { display: flex; align-items: center; gap: .75rem; margin-top: .5rem; }
    #bbd-toggle-btn {
      padding: .5rem 1.1rem;
      border-radius: 8px; border: 2px solid var(--teal);
      background: #fff; font-family: inherit; font-weight: 700;
      font-size: .95rem; cursor: pointer; color: var(--teal-dk);
      transition: background .15s;
    }
    #bbd-toggle-btn.active { background: var(--teal); color: #fff; }
    #skip-all-btn {
      display: none;
      padding: .45rem 1rem;
      border-radius: 8px; border: 2px solid #aaa;
      background: #f0f0f0; font-family: inherit; font-size: .9rem;
      cursor: pointer; color: #555;
    }
    body.bbd-active #skip-all-btn { display: inline-block; }

    /* ‚îÄ‚îÄ Basics card ‚îÄ‚îÄ */
    .basics-row { display: flex; gap: .75rem; flex-wrap: wrap; margin-top: .5rem; }
    .basic-item { display: flex; align-items: center; gap: .4rem; font-size: .95rem; }
    .basic-item input { accent-color: var(--teal); width: 1.1rem; height: 1.1rem; }

    /* ‚îÄ‚îÄ Emergency card ‚îÄ‚îÄ */
    #emergency-card { border-color: var(--red); }
    #emergency-card h2 { color: #b02032; }
    .emergency-q { font-size: 1rem; font-weight: 700; margin: .5rem 0; }
    .emerg-row { display: flex; gap: .5rem; flex-wrap: wrap; }
    .emerg-btn {
      flex: 1; min-width: 80px;
      padding: .55rem .5rem;
      border: 2px solid var(--border);
      border-radius: 8px; background: #fff;
      font-family: inherit; font-size: .95rem; font-weight: 700;
      cursor: pointer; transition: background .15s, border-color .15s;
    }
    .emerg-btn.sel-yes { background: #fde8ea; border-color: var(--red); color: #721c24; }
    .emerg-btn.sel-no  { background: #e6f4ea; border-color: var(--green); color: #155724; }

    /* ‚îÄ‚îÄ Save / Reset ‚îÄ‚îÄ */
    .save-row { display: flex; gap: .75rem; flex-wrap: wrap; margin-top: .75rem; }
    #save-btn {
      flex: 2; padding: .75rem;
      background: var(--teal); color: #fff;
      border: none; border-radius: 8px;
      font-family: inherit; font-size: 1rem; font-weight: 700;
      cursor: pointer; transition: background .15s;
    }
    #save-btn:hover { background: var(--teal-dk); }
    #save-btn:disabled { background: #aaa; cursor: not-allowed; }
    #reset-btn {
      flex: 1; padding: .75rem;
      background: #f0f0f0; color: #555;
      border: 2px solid #ccc; border-radius: 8px;
      font-family: inherit; font-size: .95rem; cursor: pointer;
    }
    #save-status {
      text-align: center; font-size: .9rem; margin-top: .5rem;
      min-height: 1.4rem; color: var(--muted);
    }

    /* ‚îÄ‚îÄ Notes final card ‚îÄ‚îÄ */
    #notes-card textarea { min-height: 80px; }
  </style>
</head>
<body>

<!-- Shared header -->
<div id="shared-header"></div>

<div class="page-wrap">
  <h1>Daily Check-In</h1>
  <p class="subtitle">Take your time. Every section is optional ‚Äî just answer what feels right today.</p>

  <!-- ‚ïê‚ïê Flag bar (shown after any gateway answered) ‚ïê‚ïê -->
  <div id="flag-bar" role="status" aria-live="polite"></div>

  <!-- ‚ïê‚ïê Thumping voices banner ‚ïê‚ïê -->
  <div id="thumping-banner" role="alert">
    üîî Thumping voices flagged ‚Äî your support team will be gently notified.
  </div>

  <!-- ‚ïê‚ïê Bad Brain Day toggle ‚ïê‚ïê -->
  <div class="card" id="bbd-card">
    <h2>üß† How are we starting today?</h2>
    <p style="font-size:.9rem;color:var(--muted);margin:.25rem 0 .5rem;">
      On a Bad Brain Day the form simplifies to just the essentials.
    </p>
    <div class="bbd-toggle-row">
      <button id="bbd-toggle-btn" onclick="toggleBBD()">Bad Brain Day mode: OFF</button>
      <button id="skip-all-btn" onclick="skipAll()">Skip all categories</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê 1. MENTAL / HEAD SPACE ‚ïê‚ïê -->
  <div class="card" id="cat-mental">
    <h2>üß† Mental / Head Space</h2>
    <p class="gateway-q">Is your head feeling okay enough to think and engage today?</p>
    <p class="reassurance">There's no wrong answer here ‚Äî this is just a temperature check.</p>
    <div class="gw-row">
      <button class="gw-btn" id="gw-mental-yes"  onclick="selectGW('mental','yes')">‚úÖ Yes</button>
      <button class="gw-btn" id="gw-mental-no"   onclick="selectGW('mental','no')">‚ùå No</button>
      <button class="gw-btn" id="gw-mental-skip" onclick="selectGW('mental','skip')">‚è≠ Skip</button>
    </div>

    <!-- Yes expand -->
    <div class="expand" id="expand-mental-yes">
      <h3>How's your head space? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="mental_yes" value="focused"> Feeling focused or clear-headed</label></li>
        <li><label><input type="checkbox" name="mental_yes" value="creative"> Feeling creative or motivated</label></li>
        <li><label><input type="checkbox" name="mental_yes" value="anxious"> Some anxiety in the background</label></li>
        <li><label>
          <input type="checkbox" id="thumping-mental" onchange="updateThumping()">
          üîî Hearing thumping voices / intrusive thoughts
        </label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">How charged are you right now?</p>
      <div class="emoji-row" id="emoji-mental-yes"></div>
    </div>

    <!-- No expand -->
    <div class="expand" id="expand-mental-no">
      <h3>What's making it hard? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="mental_no" value="brain_fog"> Brain fog ‚Äî hard to think clearly</label></li>
        <li><label><input type="checkbox" name="mental_no" value="overwhelmed"> Overwhelmed or shut-down feeling</label></li>
        <li><label><input type="checkbox" name="mental_no" value="anxiety"> Anxiety or racing thoughts</label></li>
        <li><label><input type="checkbox" name="mental_no" value="depression"> Depression or low mood</label></li>
        <li><label><input type="checkbox" name="mental_no" value="dissociating"> Dissociating or spacing out</label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">Roughly how depleted does it feel?</p>
      <div class="emoji-row" id="emoji-mental-no"></div>
    </div>

    <!-- Note (shown on yes/no, hidden on skip) -->
    <div class="note-wrap" id="note-wrap-mental" style="display:none;">
      <label for="note-mental">Anything else about your head space today? (optional)</label>
      <textarea id="note-mental" placeholder="Optional note‚Ä¶"></textarea>
    </div>
  </div>

  <!-- ‚ïê‚ïê 2. PHYSICAL / BODY ‚ïê‚ïê -->
  <div class="card" id="cat-physical">
    <h2>ü´Ä Physical / Body</h2>
    <p class="gateway-q">Is your body holding up okay today?</p>
    <p class="reassurance">Even small stuff counts ‚Äî this is about your whole body experience.</p>
    <div class="gw-row">
      <button class="gw-btn" id="gw-physical-yes"  onclick="selectGW('physical','yes')">‚úÖ Yes</button>
      <button class="gw-btn" id="gw-physical-no"   onclick="selectGW('physical','no')">‚ùå No</button>
      <button class="gw-btn" id="gw-physical-skip" onclick="selectGW('physical','skip')">‚è≠ Skip</button>
    </div>

    <!-- Yes expand -->
    <div class="expand" id="expand-physical-yes">
      <h3>Great! Any symptoms to note? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="physical_yes" value="fatigue"> Some fatigue</label></li>
        <li><label><input type="checkbox" name="physical_yes" value="pain"> Pain or discomfort</label></li>
        <li><label><input type="checkbox" name="physical_yes" value="headache"> Headache</label></li>
        <li><label><input type="checkbox" name="physical_yes" value="nausea"> Nausea</label></li>
        <li><label><input type="checkbox" name="physical_yes" value="sleep_ok"> Slept okay last night</label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">Overall physical energy?</p>
      <div class="emoji-row" id="emoji-physical-yes"></div>
    </div>

    <!-- No expand -->
    <div class="expand" id="expand-physical-no">
      <h3>What's going on? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="physical_no" value="exhausted"> Severely exhausted / crash</label></li>
        <li><label><input type="checkbox" name="physical_no" value="pain_high"> High pain levels</label></li>
        <li><label><input type="checkbox" name="physical_no" value="sick"> Feeling sick or unwell</label></li>
        <li><label><input type="checkbox" name="physical_no" value="no_sleep"> Poor or no sleep last night</label></li>
        <li><label><input type="checkbox" name="physical_no" value="mobility"> Mobility or sensory issues</label></li>
        <li><label>
          <input type="checkbox" id="thumping-physical" onchange="updateThumping()">
          üîî Physical symptoms feel overwhelming / hard to manage
        </label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">How depleted does your body feel?</p>
      <div class="emoji-row" id="emoji-physical-no"></div>
    </div>

    <div class="note-wrap" id="note-wrap-physical" style="display:none;">
      <label for="note-physical">Anything else about how your body feels? (optional)</label>
      <textarea id="note-physical" placeholder="Optional note‚Ä¶"></textarea>
    </div>
  </div>

  <!-- ‚ïê‚ïê 3. SCHOOL / ACADEMIC ‚ïê‚ïê -->
  <div class="card" id="cat-school">
    <h2>üìö School</h2>
    <p class="gateway-q">Do you feel able to engage with school stuff today?</p>
    <p class="reassurance">This is about capacity, not performance ‚Äî no judgment here.</p>
    <div class="gw-row">
      <button class="gw-btn" id="gw-school-yes"  onclick="selectGW('school','yes')">‚úÖ Yes</button>
      <button class="gw-btn" id="gw-school-no"   onclick="selectGW('school','no')">‚ùå No</button>
      <button class="gw-btn" id="gw-school-skip" onclick="selectGW('school','skip')">‚è≠ Skip</button>
    </div>

    <!-- Yes expand -->
    <div class="expand" id="expand-school-yes">
      <h3>Good! What's on your plate? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="school_yes" value="planner"> Reviewed planner / to-do list today</label></li>
        <li><label><input type="checkbox" name="school_yes" value="assignment"> Assignment or project to work on</label></li>
        <li><label><input type="checkbox" name="school_yes" value="class"> Class or meeting to attend</label></li>
        <li><label><input type="checkbox" name="school_yes" value="ahead"> Feeling ahead or on track</label></li>
        <li><label><input type="checkbox" name="school_yes" value="behind"> Feeling a little behind</label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">How's your academic energy today?</p>
      <div class="emoji-row" id="emoji-school-yes"></div>
    </div>

    <!-- No expand -->
    <div class="expand" id="expand-school-no">
      <h3>That's okay. What feels hardest right now? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="school_no" value="overwhelmed"> Overwhelmed by workload</label></li>
        <li><label><input type="checkbox" name="school_no" value="deadline"> Missing deadline or already behind</label></li>
        <li><label><input type="checkbox" name="school_no" value="executive"> Executive function / can't start tasks</label></li>
        <li><label><input type="checkbox" name="school_no" value="prof"> Issue with professor or class</label></li>
        <li><label><input type="checkbox" name="school_no" value="accommodation"> Need accommodation support</label></li>
      </ul>
    </div>

    <div class="note-wrap" id="note-wrap-school" style="display:none;">
      <label for="note-school">Anything specific about school today? (optional)</label>
      <textarea id="note-school" placeholder="Optional note‚Ä¶"></textarea>
    </div>
  </div>

  <!-- ‚ïê‚ïê 4. SPIRITUAL ‚ïê‚ïê -->
  <div class="card" id="cat-spiritual">
    <h2>‚ú® Spiritual</h2>
    <p class="gateway-q">How's your inner sense of meaning, peace, or groundedness today?</p>
    <p class="reassurance">This can be religious, personal, or just a general sense of okay-ness.</p>
    <div class="gw-row">
      <button class="gw-btn" id="gw-spiritual-yes"  onclick="selectGW('spiritual','yes')">‚úÖ Yes</button>
      <button class="gw-btn" id="gw-spiritual-no"   onclick="selectGW('spiritual','no')">‚ùå No</button>
      <button class="gw-btn" id="gw-spiritual-skip" onclick="selectGW('spiritual','skip')">‚è≠ Skip</button>
    </div>

    <!-- Yes expand -->
    <div class="expand" id="expand-spiritual-yes">
      <h3>What's grounding you? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="spiritual_yes" value="prayer"> Prayer or meditation</label></li>
        <li><label><input type="checkbox" name="spiritual_yes" value="scripture"> Scripture or devotional reading</label></li>
        <li><label><input type="checkbox" name="spiritual_yes" value="nature"> Time in nature or outdoors</label></li>
        <li><label><input type="checkbox" name="spiritual_yes" value="gratitude"> Feeling grateful or at peace</label></li>
        <li><label><input type="checkbox" name="spiritual_yes" value="community"> Connected to faith community</label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">How grounded do you feel?</p>
      <div class="emoji-row" id="emoji-spiritual-yes"></div>
    </div>

    <!-- No expand -->
    <div class="expand" id="expand-spiritual-no">
      <h3>That's okay. What feels off? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="spiritual_no" value="disconnected"> Feeling disconnected or empty</label></li>
        <li><label><input type="checkbox" name="spiritual_no" value="doubt"> Doubt or spiritual struggle</label></li>
        <li><label><input type="checkbox" name="spiritual_no" value="grief"> Grief or loss</label></li>
        <li><label><input type="checkbox" name="spiritual_no" value="lonely"> Spiritual loneliness</label></li>
      </ul>
    </div>

    <div class="note-wrap" id="note-wrap-spiritual" style="display:none;">
      <label for="note-spiritual">Anything on your heart today? (optional)</label>
      <textarea id="note-spiritual" placeholder="Optional note‚Ä¶"></textarea>
    </div>
  </div>

  <!-- ‚ïê‚ïê 5. SOCIAL / HEART ‚ïê‚ïê -->
  <div class="card" id="cat-social">
    <h2>üíõ Social / Heart</h2>
    <p class="gateway-q">Have you felt connected to people who support you recently?</p>
    <p class="reassurance">Connection looks different for everyone ‚Äî even a text counts.</p>
    <div class="gw-row">
      <button class="gw-btn" id="gw-social-yes"  onclick="selectGW('social','yes')">‚úÖ Yes</button>
      <button class="gw-btn" id="gw-social-no"   onclick="selectGW('social','no')">‚ùå No</button>
      <button class="gw-btn" id="gw-social-skip" onclick="selectGW('social','skip')">‚è≠ Skip</button>
    </div>

    <!-- Yes expand -->
    <div class="expand" id="expand-social-yes">
      <h3>Great! Who or what connected you? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="social_yes" value="family"> Family</label></li>
        <li><label><input type="checkbox" name="social_yes" value="friend"> Friend</label></li>
        <li><label><input type="checkbox" name="social_yes" value="support_team"> Support team (counselor, coach, etc.)</label></li>
        <li><label><input type="checkbox" name="social_yes" value="online"> Online community or group</label></li>
        <li><label><input type="checkbox" name="social_yes" value="cozy_solo"> Enjoyed meaningful solo time</label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">How connected does your heart feel?</p>
      <div class="emoji-row" id="emoji-social-yes"></div>
    </div>

    <!-- No expand -->
    <div class="expand" id="expand-social-no">
      <h3>What's making connection hard? (check all that apply)</h3>
      <ul class="checklist">
        <li><label><input type="checkbox" name="social_no" value="isolated"> Feeling isolated or alone</label></li>
        <li><label><input type="checkbox" name="social_no" value="conflict"> Conflict or tension with someone</label></li>
        <li><label><input type="checkbox" name="social_no" value="energy"> Not enough energy to reach out</label></li>
        <li><label><input type="checkbox" name="social_no" value="rejection"> Fear of rejection or judgment</label></li>
        <li><label><input type="checkbox" name="social_no" value="withdrawal"> Wanting to withdraw completely</label></li>
      </ul>
      <p style="font-size:.85rem;color:var(--muted);margin:.5rem 0 .25rem;">How does your heart feel right now?</p>
      <div class="emoji-row" id="emoji-social-no"></div>
    </div>

    <div class="note-wrap" id="note-wrap-social" style="display:none;">
      <label for="note-social">Anything else about connections today? (optional)</label>
      <textarea id="note-social" placeholder="Optional note‚Ä¶"></textarea>
    </div>
  </div>

  <!-- ‚ïê‚ïê Quick Basics ‚ïê‚ïê -->
  <div class="card" id="basics-card">
    <h2>ü•§ Quick Basics</h2>
    <p style="font-size:.9rem;color:var(--muted);margin-bottom:.5rem;">Check off what you've done so far today:</p>
    <div class="basics-row">
      <div class="basic-item">
        <input type="checkbox" id="basics-ate" name="basics" value="ate">
        <label for="basics-ate">üçΩ Eaten something</label>
      </div>
      <div class="basic-item">
        <input type="checkbox" id="basics-water" name="basics" value="water">
        <label for="basics-water">üíß Had water</label>
      </div>
      <div class="basic-item">
        <input type="checkbox" id="basics-meds" name="basics" value="meds">
        <label for="basics-meds">üíä Took meds (if applicable)</label>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê Emergency ‚ïê‚ïê -->
  <div class="card" id="emergency-card">
    <h2>üÜò Safety Check</h2>
    <p class="emergency-q">Are you in crisis or having thoughts of harming yourself?</p>
    <div class="emerg-row">
      <button class="emerg-btn" id="emerg-yes" onclick="selectEmergency('yes')">Yes ‚Äî I need help</button>
      <button class="emerg-btn" id="emerg-no"  onclick="selectEmergency('no')">No ‚Äî I'm okay</button>
    </div>
    <div id="emerg-expand" style="display:none; margin-top:.75rem;">
      <p style="color:var(--red);font-weight:700;margin-bottom:.5rem;">
        Your safety matters ‚Äî you're not alone. Reaching out is brave. üíõ
      </p>
      <p style="font-size:.9rem;">
        Please call or text <strong>988</strong> (Suicide &amp; Crisis Lifeline) or text HOME to <strong>741741</strong>.
        Your support team is being notified.
      </p>
    </div>
  </div>

  <!-- ‚ïê‚ïê Final notes ‚ïê‚ïê -->
  <div class="card" id="notes-card">
    <h2>üìù Anything else?</h2>
    <div class="note-wrap">
      <label for="final-note">Open notes ‚Äî share anything you want your team to know:</label>
      <textarea id="final-note" placeholder="Whatever's on your mind‚Ä¶"></textarea>
    </div>
    <div class="save-row">
      <button id="save-btn" onclick="saveCheckin()">Save Check-In</button>
      <button id="reset-btn" onclick="resetForm()">Start Over</button>
    </div>
    <div id="save-status"></div>
  </div>

</div><!-- /page-wrap -->

<!-- Firebase compat SDK 10.7.1 ‚Äî Updated 2026-02-28 by Claude: was 9.22.2 + no auth; now matches rest of app -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="/Academic-Allies/modular/aa-firebase.js"></script>
<!-- Updated 2026-03-01 by Claude: added cache-bust version string to match shared-header.html reference -->
<script src="/Academic-Allies/modular/js/aa-mirror.js?v=20260301a"></script>

<script>
// ‚îÄ‚îÄ Firebase init: aa-firebase.js owns initialisation; db set after AA is ready ‚îÄ‚îÄ
// Updated 2026-02-28 by Claude ‚Äî removed duplicate inline initializeApp(); aa-firebase.js handles it.
var db = null; // set in waitForAA below

// ‚îÄ‚îÄ Mary's confirmed 10-point energy scale (DO NOT CHANGE) ‚îÄ‚îÄ
var EMOJIS = [
  { e:'üòÅ', lbl:'Fully Charged',      t:'g', v:1  },
  { e:'üòä', lbl:'Energized',           t:'g', v:2  },
  { e:'üôÇ', lbl:'Pretty Good',         t:'g', v:3  },
  { e:'üôÇ', lbl:'Doing Okay',          t:'g', v:4  },
  { e:'üòê', lbl:'Neutral',             t:'y', v:5  },
  { e:'üòï', lbl:'Starting to Tire',    t:'o', v:6  },
  { e:'üòü', lbl:'Pretty Tired',        t:'o', v:7  },
  { e:'üò´', lbl:'Very Exhausted',      t:'r', v:8  },
  { e:'üò©', lbl:'Almost Empty',        t:'r', v:9  },
  { e:'‚ò†Ô∏è', lbl:'Completely Depleted', t:'r', v:10 }
];

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
var gwState    = {};   // { mental: 'yes'|'no'|'skip', ... }
var catEmoji   = {};   // { 'mental-yes': 3, 'physical-no': 7, ... }
var catMood    = {};   // { mental: 'Pretty Good', ... }  (label string)
var bbdActive  = false;
var emergencyYes = false;
// Tracks the most recent computed flag so saveCheckin() can persist it.
// Updated by showFlag(). Added 2026-02-28 by Claude.
var _savedFlag = 'g';

// ‚îÄ‚îÄ Build emoji rows on load ‚îÄ‚îÄ
var emojiTargets = [
  'emoji-mental-yes','emoji-mental-no',
  'emoji-physical-yes','emoji-physical-no',
  'emoji-school-yes',
  'emoji-spiritual-yes',
  'emoji-social-yes','emoji-social-no'
];
emojiTargets.forEach(function(id) {
  buildEmojiRow(id);
});

function buildEmojiRow(containerId) {
  var wrap = document.getElementById(containerId);
  if (!wrap) return;
  EMOJIS.forEach(function(em, idx) {
    var btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'emoji-btn';
    btn.setAttribute('aria-label', em.lbl);
    btn.innerHTML = '<span class="em">' + em.e + '</span><span class="lbl">' + em.lbl + '</span>';
    btn.onclick = function() { selEmoji(containerId, btn, idx); };
    wrap.appendChild(btn);
  });
}

// ‚îÄ‚îÄ Gateway logic ‚îÄ‚îÄ
function selectGW(cat, ans) {
  gwState[cat] = ans;

  // Style buttons
  ['yes','no','skip'].forEach(function(a) {
    var btn = document.getElementById('gw-' + cat + '-' + a);
    if (!btn) return;
    btn.className = 'gw-btn' + (a === ans ? ' sel-' + a : '');
  });

  // Show/hide expands
  ['yes','no'].forEach(function(a) {
    var el = document.getElementById('expand-' + cat + '-' + a);
    if (!el) return;
    el.classList.toggle('open', a === ans && ans !== 'skip');
  });

  // Show/hide note
  var noteWrap = document.getElementById('note-wrap-' + cat);
  if (noteWrap) noteWrap.style.display = (ans !== 'skip') ? 'block' : 'none';

  computeFlag();
}

// ‚îÄ‚îÄ Emoji selection ‚îÄ‚îÄ
function selEmoji(containerId, btn, idx) {
  var wrap = document.getElementById(containerId);
  if (!wrap) return;
  // Deselect all in this row
  wrap.querySelectorAll('.emoji-btn').forEach(function(b) {
    b.className = 'emoji-btn';
  });
  // Select clicked
  var em = EMOJIS[idx];
  btn.className = 'emoji-btn sel-' + em.t;
  catEmoji[containerId] = em.v;

  // Store mood label per category (use the container prefix)
  var cat = containerId.replace('emoji-','').replace('-yes','').replace('-no','');
  catMood[cat] = em.lbl;

  computeFlag();
}

// ‚îÄ‚îÄ Thumping voices ‚îÄ‚îÄ
function updateThumping() {
  var mental   = document.getElementById('thumping-mental');
  var physical = document.getElementById('thumping-physical');
  var on = (mental && mental.checked) || (physical && physical.checked);
  var banner = document.getElementById('thumping-banner');
  banner.classList.toggle('show', on);
  computeFlag();
}

// ‚îÄ‚îÄ Flag logic ‚îÄ‚îÄ
// worst emoji 1-4 ‚Üí green, 5-7 ‚Üí yellow, 8-10 ‚Üí red
// thumping ‚Üí at least yellow
// 3+ No gateways ‚Üí yellow
// Physical Yes + emoji>=8 ‚Üí red
// Mental Yes + emoji=10 ‚Üí red
// emergency Yes ‚Üí always red
function computeFlag() {
  var anyAnswered = Object.keys(gwState).length > 0;
  if (!anyAnswered) {
    document.getElementById('flag-bar').classList.remove('show');
    return;
  }

  var flag = 'g'; // green default
  var noCount = 0;
  var thumping = false;
  var mental_t = document.getElementById('thumping-mental');
  var physical_t = document.getElementById('thumping-physical');
  if ((mental_t && mental_t.checked) || (physical_t && physical_t.checked)) thumping = true;

  Object.keys(gwState).forEach(function(cat) {
    if (gwState[cat] === 'no') noCount++;
  });

  // Worst emoji across all answered categories
  var worstV = 0;
  Object.keys(catEmoji).forEach(function(k) {
    if (catEmoji[k] > worstV) worstV = catEmoji[k];
  });

  if (emergencyYes) {
    flag = 'r';
  } else {
    // emoji-based
    if (worstV >= 8) flag = 'r';
    else if (worstV >= 5) flag = setFlag(flag, 'y');

    // thumping
    if (thumping) flag = setFlag(flag, 'y');

    // 3+ No gateways
    if (noCount >= 3) flag = setFlag(flag, 'y');

    // Physical yes + emoji >= 8
    var physYesV = catEmoji['emoji-physical-yes'] || 0;
    if (gwState.physical === 'yes' && physYesV >= 8) flag = 'r';

    // Mental yes + emoji = 10
    var mentalYesV = catEmoji['emoji-mental-yes'] || 0;
    if (gwState.mental === 'yes' && mentalYesV === 10) flag = 'r';
  }

  showFlag(flag);
}

function setFlag(cur, next) {
  var order = ['g','y','o','r'];
  return order.indexOf(next) > order.indexOf(cur) ? next : cur;
}

function showFlag(f) {
  _savedFlag = f; // capture for saveCheckin() ‚Äî Added 2026-02-28 by Claude
  var bar = document.getElementById('flag-bar');
  bar.className = 'flag-bar show flag-' + f;
  var msgs = {
    g: 'üü¢ Overall: Looking good today.',
    y: 'üü° Some concerns noted ‚Äî your team will check in gently.',
    o: 'üü† A few things to watch ‚Äî support is standing by.',
    r: 'üî¥ Flagged for urgent attention ‚Äî you are not alone. üíõ'
  };
  bar.textContent = msgs[f] || '';
  bar.classList.add('show');
}

// ‚îÄ‚îÄ Emergency ‚îÄ‚îÄ
function selectEmergency(ans) {
  emergencyYes = (ans === 'yes');
  document.getElementById('emerg-yes').className = 'emerg-btn' + (ans==='yes' ? ' sel-yes' : '');
  document.getElementById('emerg-no').className  = 'emerg-btn' + (ans==='no'  ? ' sel-no'  : '');
  document.getElementById('emerg-expand').style.display = emergencyYes ? 'block' : 'none';
  computeFlag();
}

// ‚îÄ‚îÄ Bad Brain Day ‚îÄ‚îÄ
function toggleBBD() {
  bbdActive = !bbdActive;
  document.body.classList.toggle('bbd-active', bbdActive);
  var btn = document.getElementById('bbd-toggle-btn');
  btn.textContent = 'Bad Brain Day mode: ' + (bbdActive ? 'ON' : 'OFF');
  btn.classList.toggle('active', bbdActive);
}

function skipAll() {
  ['mental','physical','school','spiritual','social'].forEach(function(cat) {
    selectGW(cat, 'skip');
  });
}

// ‚îÄ‚îÄ Save ‚îÄ‚îÄ
function saveCheckin() {
  var btn = document.getElementById('save-btn');
  var status = document.getElementById('save-status');
  btn.disabled = true;
  status.textContent = 'Saving‚Ä¶';

  // Collect categories object
  var categories = {};
  ['mental','physical','school','spiritual','social'].forEach(function(cat) {
    if (!gwState[cat]) return;
    var checked = [];
    document.querySelectorAll('[name=' + cat + '_' + gwState[cat] + ']:checked').forEach(function(cb) {
      checked.push(cb.value);
    });
    var emojiKey = gwState[cat] !== 'skip'
      ? ('emoji-' + cat + '-' + gwState[cat])
      : null;
    categories[cat] = {
      gateway: gwState[cat],
      checked: checked,
      emojiV:  emojiKey ? (catEmoji[emojiKey] || null) : null,
      mood:    emojiKey ? (catMood[cat]        || null) : null,
      note:    (document.getElementById('note-' + cat) || {}).value || ''
    };
  });

  // Basics
  var basics = [];
  document.querySelectorAll('[name=basics]:checked').forEach(function(cb) { basics.push(cb.value); });

  // Thumping
  var tm = document.getElementById('thumping-mental');
  var tp = document.getElementById('thumping-physical');
  var thumping = (tm && tm.checked) || (tp && tp.checked);

  // Legacy compat fields (for status-circle.js and existing queries)
  var mentalCat  = categories.mental  || {};
  var physCat    = categories.physical || {};
  var schoolCat  = categories.school  || {};
  var socialCat  = categories.social  || {};

  var entry = {
    timestamp:    new Date(),
    bbdMode:      bbdActive,
    categories:   categories,
    basics:       basics,
    thumping:     thumping,
    emergency:    emergencyYes,
    finalNote:    document.getElementById('final-note').value || '',

    // Legacy compat
    energyLevel:  mentalCat.emojiV || null,
    mood:         mentalCat.mood   || null,
    symptoms:     physCat.gateway === 'no',
    symptomList:  physCat.checked  || [],
    support:      socialCat.gateway === 'yes',
    planner:      (schoolCat.checked || []).indexOf('planner') !== -1
  };

  // ‚îÄ‚îÄ Add the computed flag to the entry so support network can read it ‚îÄ‚îÄ
  // Short codes: g=green y=yellow o=orange r=red. Added 2026-02-28 by Claude.
  var FLAG_FULL = { g: 'green', y: 'yellow', o: 'orange', r: 'red' };
  entry.flag = FLAG_FULL[_savedFlag] || 'green';

  // ‚îÄ‚îÄ Cache in localStorage (format status-circle.js expects) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  var dateKey = new Date().toISOString().split('T')[0];
  try {
    var existing = JSON.parse(localStorage.getItem('checkins_' + dateKey) || '[]');
    existing.push(entry);
    localStorage.setItem('checkins_' + dateKey, JSON.stringify(existing));
  } catch (e) {}

  // ‚îÄ‚îÄ Save to Firestore via AA.saveCheckin ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Updated 2026-02-28 by Claude: now uses waitForAA to ensure aa-firebase.js
  // is ready before writing. Path: checkins/{uid}/days/{date} matches what
  // status-circle.js and loadStudentStatus() both read from.
  function doFirestoreSave() {
    if (!AA.auth.currentUser) {
      status.textContent = '‚úÖ Saved locally! Sign in to sync with your support network. üíõ';
      btn.disabled = false;
      return;
    }
    AA.saveCheckin(AA.auth.currentUser.uid, dateKey, entry)
      .then(function () {
        status.textContent = '‚úÖ Check-in saved! Great job showing up today. üíõ';
        btn.disabled = false;
      })
      .catch(function (err) {
        console.error('[AA] checkin save error:', err);
        status.textContent = '‚ö†Ô∏è Saved locally ‚Äî sync failed. Try again. ' + err.message;
        btn.disabled = false;
      });
  }

  waitForAA(doFirestoreSave, function() {
    // AA never became available ‚Äî localStorage-only fallback
    status.textContent = '‚úÖ Saved locally! Connect to the internet to sync. üíõ';
    btn.disabled = false;
  });
}

// ‚îÄ‚îÄ waitForAA: poll until window.AA is ready, then call cb. ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Added 2026-02-28 by Claude ‚Äî needed because aa-firebase.js loads async.
function waitForAA(cb, fallback, tries) {
  tries = tries || 0;
  if (window.AA && window.AA.auth && window.AA.db) { cb(); return; }
  if (tries > 30) { if (fallback) fallback(); return; }
  setTimeout(function() { waitForAA(cb, fallback, tries + 1); }, 200);
}

// ‚îÄ‚îÄ Reset ‚îÄ‚îÄ
function resetForm() {
  if (!confirm('Start over? Your current check-in will be lost.')) return;

  gwState    = {};
  catEmoji   = {};
  catMood    = {};
  bbdActive  = false;
  emergencyYes = false;

  document.body.classList.remove('bbd-active');
  document.getElementById('bbd-toggle-btn').textContent = 'Bad Brain Day mode: OFF';
  document.getElementById('bbd-toggle-btn').classList.remove('active');

  // Reset gateway buttons
  ['mental','physical','school','spiritual','social'].forEach(function(cat) {
    ['yes','no','skip'].forEach(function(a) {
      var btn = document.getElementById('gw-' + cat + '-' + a);
      if (btn) btn.className = 'gw-btn';
    });
    var eyEl = document.getElementById('expand-' + cat + '-yes');
    var enEl = document.getElementById('expand-' + cat + '-no');
    if (eyEl) eyEl.classList.remove('open');
    if (enEl) enEl.classList.remove('open');
    var nw = document.getElementById('note-wrap-' + cat);
    if (nw) nw.style.display = 'none';
  });

  // Reset emoji rows
  emojiTargets.forEach(function(id) {
    var wrap = document.getElementById(id);
    if (wrap) wrap.querySelectorAll('.emoji-btn').forEach(function(b) { b.className = 'emoji-btn'; });
  });

  // Reset checkboxes
  document.querySelectorAll('input[type=checkbox]').forEach(function(cb) { cb.checked = false; });

  // Reset textareas
  document.querySelectorAll('textarea').forEach(function(ta) { ta.value = ''; });

  // Reset emergency
  document.getElementById('emerg-yes').className = 'emerg-btn';
  document.getElementById('emerg-no').className  = 'emerg-btn';
  document.getElementById('emerg-expand').style.display = 'none';

  // Reset flag/thumping/save status
  document.getElementById('flag-bar').classList.remove('show');
  document.getElementById('thumping-banner').classList.remove('show');
  document.getElementById('save-status').textContent = '';

  // Reset basics
  document.querySelectorAll('[name=basics]').forEach(function(cb) { cb.checked = false; });
}
</script>

<!-- Shared header loader ‚Äî Updated 2026-02-28 by Claude: re-executes scripts so Firebase auth initialises -->
<script>
fetch('/Academic-Allies/modular/shared-header.html?v=20260228b')
  .then(function(r){ return r.text(); })
  .then(function(html){
    var container = document.getElementById('shared-header');
    container.innerHTML = html;
    container.querySelectorAll('script').forEach(function(old) {
      var s = document.createElement('script');
      Array.from(old.attributes).forEach(function(a){ s.setAttribute(a.name, a.value); });
      s.textContent = old.textContent;
      old.replaceWith(s);
    });
  })
  .catch(function(){ /* header optional */ });

// ‚îÄ‚îÄ Mirror mode guard ‚Äî Updated 2026-02-28 by Claude ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// If a support network member lands on this page, block the form and
// show a read-only notice. Check-in is for the student, not the viewer.
(function checkMirrorOnLoad() {
  // AA_MIRROR_UID is set synchronously by aa-mirror.js if viewer is support role
  if (!window.AA_MIRROR_UID) return; // student or admin ‚Äî form is fine

  // Hide the form, show a notice
  var wrap = document.querySelector('.page-wrap');
  if (!wrap) return;
  wrap.innerHTML =
    '<h1>Daily Check-In</h1>' +
    '<div style="background:#e8eeff;border:2px solid #a5b4fc;border-radius:12px;padding:1.25rem 1.5rem;margin-top:1rem;">' +
      '<p style="font-weight:700;color:#4338ca;margin-bottom:.5rem;">üëÅ Mirror mode ‚Äî read-only</p>' +
      '<p style="font-size:.95rem;color:#5b5ea6;">The check-in form is for the student, not the support network. ' +
      'You can see their status in <a href="/Academic-Allies/modular/components/user-tiers/user-tiers.html" ' +
      'style="color:#4338ca;">the support network page</a>.</p>' +
    '</div>';
})();
</script>

</body>
</html>
