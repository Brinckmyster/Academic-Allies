<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academic Allies</title>
  <meta name="description" content="Academic Allies: Your disability accommodations and support network">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --color-background: #fcfcf9;
      --color-surface: #fffdfd;
      --color-text: #13343b;
      --color-text-secondary: #626c71;
      --color-primary: #21808d;
      --color-primary-hover: #1d7480;
      --color-primary-active: #1a6873;
      --color-secondary: rgba(94,82,64,0.12);
      --color-border: rgba(94,82,64,0.2);
      --color-btn-text: #fffdfd;
      --color-error: #c0152f;
      --color-success: #21808d;
      --color-warning: #a84b2f;
      --color-info: #626c71;
      --color-academic: #bdbdbd;
      --color-social: #8b5cf6;
      --radius: 8px;
      --space: 16px;
      --shadow: 0 4px 6px -1px rgba(0,0,0,0.04),0 2px 4px -1px rgba(0,0,0,0.02);
    }
    body { font-family: 'Atkinson Hyperlegible','OpenDyslexic',Arial, sans-serif; background: var(--color-background); color: var(--color-text); margin:0; padding:var(--space); }
    header { position: relative; text-align: center; margin-bottom: var(--space); }
    .home-icon { position: absolute; top:0; left:0; font-size:1.5em; cursor:pointer; }
    .tagline { color: var(--color-primary); margin-top:4px; }
    .google-signin { display:flex; justify-content:center; margin:var(--space) 0; }
    .status-indicator { position: fixed; top:var(--space); right:var(--space); z-index:1000; }
    .status-circle { width:60px; height:60px; border-radius:50%; background:var(--color-success); border:2px solid var(--color-border); display:flex; align-items:center; justify-content:center; box-shadow:var(--shadow); cursor:pointer; }
    .status-circle.segments { background:transparent; }
    .status-segment { position:absolute; width:100%; height:100%; clip-path:polygon(50% 50%,100% 0,100% 100%,0 100%,0 0); transform-origin:center; }
    nav { display:flex; justify-content:center; gap:1em; flex-wrap:wrap; margin:var(--space) 0; }
    nav button { background:var(--color-primary); color:var(--color-btn-text); border:none; padding:0.5em 1em; border-radius:var(--radius); cursor:pointer; min-width:100px; }
    nav button.active { background:var(--color-primary-active); }
    section { display:none; max-width:720px; margin:0 auto var(--space); background:var(--color-surface); border-radius:var(--radius); box-shadow:var(--shadow); padding:var(--space); }
    section.active { display:block; }
    .btn { background:var(--color-primary); color:var(--color-btn-text); border:none; padding:0.5em 1em; border-radius:var(--radius); cursor:pointer; margin:0.5em 0; }
    .btn:hover { background:var(--color-primary-hover); }
    .minimal-ui nav, .minimal-ui .quick-actions, .minimal-ui .calendar-preview, .minimal-ui #perplexity-ai-panel, .minimal-ui .contact-grid, .minimal-ui #logs { display:none; }
    .minimal-ui section { padding:var(--space); }
    *:focus { outline:2px solid var(--color-info); outline-offset:2px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/pouchdb@7.3.1/dist/pouchdb.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>
</head>
<body>
  <header>
    <div class="home-icon" onclick="show('dashboard')">üè†</div>
    <h1>Academic Allies</h1>
    <p class="tagline">Your disability accommodations and support network</p>
  </header>

  <div class="google-signin" id="googleSignInContainer"></div>
  <div class="status-indicator"><div class="status-circle" id="statusCircle" tabindex="0" onclick="toggleStatusView()"></div></div>
  <nav id="mainNav"></nav>

  <section id="dashboard" class="active"></section>
  <section id="checkins"></section>
  <section id="logs"></section>
  <section id="admin"></section>
  <section id="messages"></section>
  <section id="emergency"></section>
  <section id="settings"></section>

  <script>
  // App Status
  let appStatus = 'normal'; // 'normal','semi-nope','nope','bad brain','recovery'
  function setStatus(s){ appStatus=s; document.body.classList.toggle('minimal-ui',s==='nope'||s==='semi-nope'); renderAll(); }

  // Offline DB Sync
  const localDB = new PouchDB('academic_allies');
  ['https://YOUR-COUCHDB','https://YOUR-COUCHDB-2'].forEach(u=>localDB.sync(u,{live:true,retry:true}));

  // Google OAuth & Calendar
  const CLIENT_ID='93996985456-ftjjdrj4t32h106o7cmstiuqut32vf0g.apps.googleusercontent.com';
  function initGapi(){gapi.load('client:auth2',()=>gapi.client.init({clientId:CLIENT_ID,scope:'https://www.googleapis.com/auth/calendar.readonly'}));}
  function handleCredentialResponse(r){const u=JSON.parse(atob(r.credential.split('.')[1]));document.getElementById('userName').textContent=u.given_name||u.name;document.getElementById('googleSignInContainer').style.display='none';}
  window.onload=initGapi;
  google.accounts.id.initialize({client_id:CLIENT_ID,callback:handleCredentialResponse,ux_mode:'popup'});google.accounts.id.renderButton(document.getElementById('googleSignInContainer'),{theme:'outline',size:'large'});

  // Navigation
  const modes=['dashboard','checkins','logs','admin','messages','emergency','settings'];
  modes.forEach((m,i)=>{const b=document.createElement('button');b.textContent=m.charAt(0).toUpperCase()+m.slice(1);b.dataset.sec=m;if(i===0)b.classList.add('active');b.onclick=()=>show(m);document.getElementById('mainNav').append(b);});
  function show(sec){modes.forEach(s=>{document.querySelector(`[data-sec="${s}"]`).classList.toggle('active',s===sec);document.getElementById(s).classList.toggle('active',s===sec);});}

  // Status Circle
  let statusView='single';
  function toggleStatusView(){statusView=statusView==='single'?'pie':'single';updateStatusCircle();}
  function updateStatusCircle(){const c=document.getElementById('statusCircle'),d=new Date().getDay();c.innerHTML='';c.className='status-circle';if(statusView==='pie'){c.classList.add('segments');const cnt=d===6||d===0?2:5;for(let i=0;i<cnt;i++){const types=d===6?'spiritual':d===0?'social':['mental','physical','spiritual','academic','social'][i];const seg=document.createElement('div');seg.className=`status-segment segment-${types}`;seg.style.transform=`rotate(${i*360/cnt}deg)`;seg.title=types;seg.tabIndex=0;c.append(seg);}}else{c.style.background='var(--color-success)';c.title='Overall status';}}

  // Render Sections
  function renderDashboard(){const d=document.getElementById('dashboard'),n=new Date();d.innerHTML=`
    <div class="dashboard-summary">
      <h2>Welcome back, <span id="userName">Mary</span>!</h2>
      <p class="date-time">${n.toLocaleString(undefined,{weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}</p>
      <div class="status-grid"><div><strong>Brain Fog:</strong> Moderate</div><div><strong>Cognitive:</strong> 35</div><div><strong>Checklist:</strong> 4/6</div></div>
      <div class="quick-actions"><button onclick="show('checkins')">Start Check-In</button><button onclick="show('logs')">See Logs</button><button onclick="show('messages')">Send Message</button><button onclick="show('emergency')">Emergency</button></div>
      <div class="calendar-preview"><strong>Calendar:</strong><label><input type="checkbox" checked> Google</label><ul id="todaysEvents"><li>Loading‚Ä¶</li></ul></div>
    </div>`;gapi.auth2.getAuthInstance().signIn().then(()=>gapi.client.load('calendar','v3')).then(()=>gapi.client.calendar.events.list({calendarId:'primary',timeMin:(new Date()).toISOString(),singleEvents:true})).then(r=>document.getElementById('todaysEvents').innerHTML=r.result.items.map(e=>`<li>${(e.start.dateTime||e.start.date)} ‚Äì ${e.summary}</li>`).join(''));}
  function renderCheckins(){document.getElementById('checkins').innerHTML=`
    <h2>Daily Check-Ins</h2>
    <div class="checkin-reassurance">No need to answer if unsure‚Ä¶</div>
    <h3>Any significant pain, fatigue, or brain fog today?</h3>
    <div class="checkin-options"><button class="btn" onclick="submitCheckin('symptoms','no')">No</button><button class="btn" onclick="submitCheckin('symptoms','yes')">Yes</button><button class="btn" onclick="submitCheckin('symptoms','skip')">Skip</button></div>
    <div id="symptomChecklist" style="display:none;">${['headache','muscle pain','joint pain','fatigue','brain fog','dizziness','nausea','other'].map(s=>`<label><input type="checkbox" value="${s}"> ${s}</label>`).join('')}<button class="btn" onclick="submitSymptoms()">Submit</button></div>
    <div id="checkinStatus"></div>`;}
  function renderLogs(){document.getElementById('logs').innerHTML='<h2>Logs & History</h2><p>Data visualization coming soon.</p>';}
  function renderAdmin(){document.getElementById('admin').innerHTML=`
    <h2>Admin Panel</h2><h3>Support Network</h3><ul class="support-list"><li>Mary (Student)</li><li>Brinckmyster (Admin)</li><li>Mom (Family)</li><li>Support test (Support) <span class="role-desc">KarenBrinckFH@gmail.com</span></li><li>Nearby Help test (Nearby Help) <span class="role-desc">KarenBrinck@gmail.com</span></li></ul>`;}
  function renderMessages(){document.getElementById('messages').innerHTML='<h2>Messages</h2><button class="btn" onclick="composeMessage()">Compose</button><div id="messageThread"></div>';refreshMessages();}
  function renderEmergency(){document.getElementById('emergency').innerHTML='<h2>Emergency Contacts</h2><div class="contact-grid"><div class="contact-card"><h4>Disability Services</h4><p>üìû (208) 496-1158</p></div></div>';}
  function renderSettings(){document.getElementById('settings').innerHTML='<h2>Settings</h2><label><input type="radio" name="circleView" value="single" checked onchange="updateStatusCircle()"> Single Color</label><br><label><input type="radio" name="circleView" value="pie" onchange="updateStatusCircle()"> Pie Chart</label>';}

  // Check-In Logic
  function submitCheckin(type,ans){const s=document.getElementById('checkinStatus');if(type==='symptoms'){if(ans==='yes'){document.getElementById('symptomChecklist').style.display='block';s.innerHTML='';}else{document.getElementById('symptomChecklist').style.display='none';s.innerHTML=ans==='no'?'<strong>‚úì Logged:</strong> No symptoms.':'<strong>‚äù Skipped</strong>';}}}
  function submitSymptoms(){const sel=Array.from(document.querySelectorAll('#symptomChecklist input:checked')).map(i=>i.value);document.getElementById('symptomChecklist').style.display='none';document.getElementById('checkinStatus').innerHTML=`<strong>‚úì Symptoms:</strong> ${sel.join(', ')}`;}

  // Messaging
  async function refreshMessages(){const r=await localDB.find({selector:{type:'message'}});document.getElementById('messageThread').innerHTML=r.docs.map(m=>`<p><strong>${m.sender}:</strong> ${m.text}</p>`).join('');}
  function composeMessage(){const t=prompt('Message:');if(!t)return;localDB.post({type:'message',sender:'Me',text:t,timestamp:Date.now()}).then(refreshMessages);}

  // Initialize
  function renderAll(){renderDashboard();renderCheckins();renderLogs();renderAdmin();renderMessages();renderEmergency();renderSettings();}
  document.addEventListener('DOMContentLoaded',()=>{renderAll();updateStatusCircle();});
  </script>
</body>
</html>
