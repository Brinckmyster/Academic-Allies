<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Academic Allies</title>
  <meta name="description" content="Academic Allies: Your disability accommodations and support network">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8fafc; margin: 0; }
    header { text-align: center; margin-top: 2em; }
    .tagline { font-size: 1.15em; color: #4b6cb7; margin-top: 0.5em; }
    .status-indicator { position: absolute; top: 1em; right: 1em; }
    .status-circle { width: 60px; height: 60px; border-radius: 50%; background: #e0e7ef; border: 2px solid #b6c5d6; display: flex; align-items: center; justify-content: center; }
    nav { display: flex; justify-content: center; gap: 1em; margin: 2em 0 1em 0; }
    nav button { font-size: 1.1em; padding: 0.5em 1.5em; border-radius: 8px; border: none; background: #4b6cb7; color: #fff; cursor: pointer; }
    nav button.active { background: #2a4b7c; }
    section { display: none; max-width: 600px; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 2em; }
    section.active { display: block; }
    #perplexity-ai-panel { margin-top: 2em; }
    #ai-response { margin-top: 1em; background: #f3f6fa; padding: 1em; border-radius: 8px; min-height: 2em; }
    .google-signin { display: flex; justify-content: center; margin: 2em 0; }
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <header>
    <h1 style="font-size: 2.2em; font-weight: bold; color: #2a4b7c;">Academic Allies</h1>
    <p class="tagline">Your disability accommodations and support network</p>
  </header>

  <!-- Status Circle (always top right) -->
  <div class="status-indicator" id="statusIndicator">
    <div class="status-circle" id="statusCircle" title="Your current status"></div>
  </div>

  <!-- Google Sign-In Button (no edits needed) -->
  <div class="google-signin" id="googleSignInContainer">
    <div id="g_id_onload"
      data-client_id="93996985456-ftjjdrj4t32h106o7cmstiuqut32vf0g.apps.googleusercontent.com"
      data-callback="handleCredentialResponse"
      data-auto_prompt="false">
    </div>
    <div id="g_id_signin"
      class="g_id_signin"
      data-type="standard"
      data-shape="rectangular"
      data-theme="outline"
      data-text="signin_with"
      data-size="large"
      data-logo_alignment="left">
    </div>
  </div>

  <!-- Main Navigation -->
  <nav>
    <button class="nav-btn active" data-section="dashboard">Dashboard</button>
    <button class="nav-btn" data-section="checkins">Check-Ins</button>
    <button class="nav-btn" data-section="logs">Logs</button>
    <button class="nav-btn" data-section="admin">Admin Panel</button>
    <button class="nav-btn" data-section="settings">Settings</button>
  </nav>

  <!-- App Sections -->
  <section id="dashboard" class="active">
    <h2>Welcome back, <span id="userName">Mary</span>!</h2>
    <p>Here’s your daily overview. Use the navigation above to check in, review logs, or manage your support network.</p>
  </section>

  <section id="checkins">
    <h2>Daily Check-Ins</h2>
    <div class="checkin-reassurance">
      <p>No need to answer if you’re not sure. Academic Allies already checks for signs of pain, fatigue, or brain fog in the background using your typing and heart rate patterns. No action is needed from you unless you want to add more details.</p>
    </div>
    <p>Complete your check-in to update your status and notify your support network.</p>
  </section>

  <section id="logs">
    <h2>Logs & History</h2>
    <p>Review your recent check-ins, flags, and support activity.</p>
  </section>

  <section id="admin">
    <h2>Admin Panel</h2>
    <p>Manage roles, permissions, and Perplexity AI access for your support team.</p>
    <div id="perplexity-ai-panel">
      <h3>Perplexity AI Protocol Support Editor</h3>
      <p>Only Admins with Perplexity AI access can use this tool to update protocols, triggers, and support settings.<br>
      All changes are logged and visible to the student and Admins.</p>
      <textarea id="ai-input" rows="4" style="width:100%;" placeholder="Type your question or protocol update here..."></textarea>
      <button id="ai-send" style="margin-top:0.5em;">Send to Perplexity AI</button>
      <div id="ai-response"></div>
    </div>
  </section>

  <section id="settings">
    <h2>Settings</h2>
    <p>Customize your experience, notification preferences, and accessibility options.</p>
  </section>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    // Navigation logic
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
        document.getElementById(this.dataset.section).classList.add('active');
      });
    });

    // Google Sign-In logic (global for callback)
    function handleCredentialResponse(response) {
      function parseJwt(token) {
        if (!token) return {};
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
      }
      const user = parseJwt(response.credential);
      document.getElementById('googleSignInContainer').classList.add('hidden');
      const statusCircle = document.getElementById('statusCircle');
      statusCircle.innerHTML = `<img src="${user.picture}" alt="Profile" style="width:48px;height:48px;border-radius:50%;border:2px solid #3b82f6;">`;
      document.getElementById('userName').textContent = user.given_name || user.name || user.email || "User";
    }

    // Perplexity AI Panel (mockup)
    document.getElementById('ai-send').addEventListener('click', async function() {
      const input = document.getElementById('ai-input').value.trim();
      const responseDiv = document.getElementById('ai-response');
      if (!input) {
        responseDiv.textContent = "Please enter a question or update.";
        return;
      }
      responseDiv.textContent = "Thinking...";
      setTimeout(() => {
        responseDiv.textContent = "This is a mock response from Perplexity AI. (Replace with real API integration.)";
      }, 1200);
    });

    // Status Circle (simple demo)
    function updateStatusCircle(level = "good", dayOfWeek = (new Date()).getDay()) {
      const circle = document.getElementById('statusCircle');
      circle.innerHTML = "";
      let color = "#4bdb6c"; // green
      if (dayOfWeek === 6) color = "#3B82F6"; // Saturday: blue
      if (dayOfWeek === 0) color = "#8B5CF6"; // Sunday: purple
      if (level === "moderate") color = "#fbbf24";
      if (level === "bad") color = "#ef4444";
      circle.style.background = color;
    }
    updateStatusCircle();
  </script>
</body>
</html>
