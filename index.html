<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Academic Allies</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" href="icons/academic-allies.png" />
  <link rel="apple-touch-icon" href="icons/academic-allies.png" />
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background: #f5f7fa; }
    header { display: flex; align-items: center; background: #2d3a4a; color: #fff; padding: 1rem; }
    .logo { width: 40px; height: 40px; margin-right: 1rem; }
    nav { display: flex; gap: 1rem; margin-left: auto; }
    .nav-btn { background: none; border: none; color: #fff; font-size: 1rem; cursor: pointer; padding: 0.5rem 1rem; border-radius: 5px; transition: background 0.2s; }
    .nav-btn.active, .nav-btn:focus { background: #4f6d7a; outline: none; }
    main { max-width: 600px; margin: 2rem auto; background: #fff; border-radius: 12px; box-shadow: 0 2px 8px #0001; padding: 2rem; }
    section { display: none; }
    section.active { display: block; }
    .status-circle { width: 18px; height: 18px; border-radius: 50%; display: inline-block; margin-left: 0.5rem; border: 2px solid #888; vertical-align: middle; }
    .google-btn { background: #fff; border: 1px solid #888; color: #333; padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer; margin-top: 1rem; }
    .google-btn:hover { background: #f0f0f0; }
    .user-info { margin-top: 1rem; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
</head>
<body>
  <header>
    <img src="icons/academic-allies.png" alt="Academic Allies Logo" class="logo" />
    <h1 style="font-size:1.5rem; margin:0;">Academic Allies</h1>
    <nav>
      <button class="nav-btn active" data-section="dashboard">Dashboard</button>
      <button class="nav-btn" data-section="support">Support</button>
      <button class="nav-btn" data-section="settings">Settings</button>
    </nav>
  </header>
  <main>
    <section id="dashboard" class="active">
      <h2>Dashboard <span class="status-circle" id="statusCircle"></span></h2>
      <p>Welcome! Hereâ€™s your daily overview.</p>
    </section>
    <section id="support">
      <h2>Support Network</h2>
      <p>Your support contacts and resources appear here.</p>
    </section>
    <section id="settings">
      <h2>Settings</h2>
      <div id="authSection">
        <button class="google-btn" id="signInBtn">Sign in with Google</button>
        <button class="google-btn" id="signOutBtn" style="display:none;">Sign out</button>
        <div class="user-info" id="userInfo"></div>
      </div>
    </section>
  </main>
  <script>
    // --- Firebase Config: Academic Allies Project ---
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_SECURE_KEY",
      authDomain: "academic-allies-464901.firebaseapp.com",
      projectId: "academic-allies-464901",
      storageBucket: "academic-allies-464901.firebasestorage.app",
      messagingSenderId: "93996985456",
      appId: "1:93996985456:web:c697df7623bbceeb1d18b5"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // --- Navigation Logic: Panels Switch ---
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
        document.getElementById(this.dataset.section).classList.add('active');
      });
    });

    // --- Status Circle Logic ---
    function updateStatusCircle() {
      const circle = document.getElementById('statusCircle');
      if (auth.currentUser) {
        circle.style.background = '#2ecc40';
        circle.title = "Signed in";
      } else {
        circle.style.background = '#ff4136';
        circle.title = "Not signed in";
      }
    }

    // --- Google Sign-In Persistent Auth ---
    const signInBtn = document.getElementById('signInBtn');
    const signOutBtn = document.getElementById('signOutBtn');
    const userInfo = document.getElementById('userInfo');

    function showUser(user) {
      if (user) {
        userInfo.textContent = `Signed in as ${user.displayName || user.email}`;
        signInBtn.style.display = 'none';
        signOutBtn.style.display = '';
      } else {
        userInfo.textContent = '';
        signInBtn.style.display = '';
        signOutBtn.style.display = 'none';
      }
      updateStatusCircle();
    }

    auth.onAuthStateChanged(user => {
      showUser(user);
    });

    signInBtn.addEventListener('click', () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(err => alert("Sign-in error: " + err.message));
    });

    signOutBtn.addEventListener('click', () => {
      auth.signOut();
    });

    // --- Ensure Status Circle Updates on Load ---
    window.addEventListener('DOMContentLoaded', updateStatusCircle);
  </script>
</body>
</html>
